import Q from"./D0YqDxnM.js";import{e as X,z as ee,r as o,j as ae,E as te,A as se,k as le,l as oe,w as _,m as ne,o as D,a as e,b as v,c as M,g as ie,h as I,t as r,u as N,d as j,x as F,F as re,p as de,q as A,_ as ue}from"./CUZeRvXC.js";import{E as ce}from"./CYogHZGX.js";import{u as pe,_ as me}from"./Z5wW8-57.js";import{N as ve}from"./DCknVipl.js";import{a as c}from"./CkL4TXxs.js";import{E as ke}from"./ckAZWzE1.js";import{m as Y}from"./qbsqZPAI.js";import{W as ge}from"./DX0GD6l3.js";/* empty css        */import{u as ye}from"./Db-zqWpw.js";import"./DaNuMFcU.js";import"./BggygjHh.js";import"./CnmWWN_2.js";import"./Bz2aGY34.js";import"./DU8lQhTt.js";const he={id:"tasks"},fe={class:"content"},_e={class:"line page-section"},be={class:"section-head"},ze=["href"],we={key:0,class:"line page-section"},Ce={class:"icon-div"},Ie={class:"dropdown-content"},Ne=["onClick"],Ae={class:"line page-section"},Pe={class:"section-head"},Te={class:"update"},Re={class:"line page-section"},Se={class:"section-head"},De={class:"update"},je={class:"profile"},$e=["src"],Ee={class:"uppercase"},Me=X({__name:"assign",emits:["update"],setup(Ye,{emit:xe}){ye({title:"Panel | Úkoly - Přiřazení",meta:[{name:"description",content:"Panel Settings User Information"}]});const Z=ee(),x=te(),k=Z.params.taskId,s=pe(),b=o(!1),g=o(null),$=o(!1),P=o([]),p=o(void 0),m=o([]),z=o([]),w=o([]),d=o(void 0),J=o(["Třídy","Žáci"]),U=o("Třídy"),C=o(0),y=o(!1),T={select:"material-symbols:done-rounded",selected:"material-symbols:close-rounded",open:"material-symbols:arrow-downward-rounded",close:"material-symbols:arrow-upward-rounded"},h=o(!1),f=o(void 0),B=o(""),q=o([{field:"id",title:"ID",width:"90px",type:"number"},{field:"name",title:"Jméno a přijmení",type:"string"},{field:"email",title:"E-mail",type:"string"},{field:"abbreviation",title:"Zkratka",type:"date"},{field:"createdAt",title:"Vytvořen",type:"string"}]),L=t=>{p.value=t.classes},V=t=>{C.value=t,U.value=J.value[t],t===0?h.value=!0:t===1&&(h.value=!1),y.value=!1},E=()=>{$.value=!0,p.value=[...z.value],m.value=[...w.value],setTimeout(()=>{$.value=!1},100)},W=()=>{y.value=!y.value},G=()=>{g.value&&setTimeout(()=>{m.value=g.value.getSelectedRows().map(t=>t.id)},0)},H=()=>{if(!g.value||!f.value)return;f.value.map((a,u)=>m.value.includes(a.id)?u:-1).filter(a=>a!==-1).forEach(a=>{g.value.selectRow(a)})},K=async()=>{C.value===0&&(b.value=!0,await c("/task_class/update",{method:"put",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({idTask:k,idClass:p.value||[]}),credentials:"include",ignoreResponseError:!0,onResponse({response:t}){var u;switch((u=t._data.resCode)==null?void 0:u.toString()){case"32010":s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nebyl zadán id úkolu."});break;case"32020":s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Úkol neexistuje."});break;case"32030":s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nemáte oprávnění."});break;case"32040":s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nebylo nic aktualizováno."});break;case"32051":const n=t._data.data.badIds||[],l=t._data.data.goodIds||[],i=t._data.data.removedIds||[];n.length>0?s.addAlert({type:"warning",title:"Přiřazení úkolu",message:`Úkol byl přiřazen ${l.length} třídám. Některé třídy nebylo možné přiřadit. ID tříd: ${n.join(", ")}`}):i.length>0?s.addAlert({type:"success",title:"Přiřazení úkolu",message:`Úkol byl odebrán ${i.length} třídám a přiřazen ${l.length} třídám.`}):s.addAlert({type:"success",title:"Přiřazení úkolu",message:`Úkol byl úspěšně přiřazen třídám. (${l.length})`}),z.value=[...p.value||[]],E();break;default:s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nastala neznámá chyba."});break}},onRequestError(){s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nastala neznámá chyba při odesílání požadavku."})}}).finally(()=>{b.value=!1})),C.value===1&&(b.value=!0,await c("/user_task/change",{method:"put",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({idTask:k,idUser:m.value||[]}),credentials:"include",ignoreResponseError:!0,onResponse({response:t}){var u;switch((u=t._data.resCode)==null?void 0:u.toString()){case"43010":s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nebyl zadán id úkolu."});break;case"43020":s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Úkol neexistuje."});break;case"43030":s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Úkol je pouze pro třídy."});break;case"43040":s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nemáte oprávnění."});break;case"43050":s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nebylo nic aktualizováno."});break;case"43061":const n=t._data.data.badIds||[],l=t._data.data.goodIds||[],i=t._data.data.removedIds||[];n.length>0?s.addAlert({type:"warning",title:"Přiřazení úkolu",message:`Úkol byl přiřazen ${l.length} uživatelům. Někteří uživatelé nebyli nalezeni. ID uživatelů: ${n.join(", ")}`}):i.length>0?s.addAlert({type:"success",title:"Přiřazení úkolu",message:`Úkol byl odebrán ${i.length} uživatelům a přiřazen ${l.length} uživatelům.`}):s.addAlert({type:"success",title:"Přiřazení úkolu",message:`Úkol byl úspěšně přiřazen uživatelům. (${l.length})`}),w.value=[...m.value||[]],E();break;default:s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nastala neznámá chyba."});break}},onRequestError(){s.addAlert({type:"error",title:"Přiřazení úkolu",message:"Nastala neznámá chyba při odesílání požadavku."})}}).finally(()=>{b.value=!1}))};return ae(async()=>{try{await c("/class/get",{method:"get",headers:{"Content-Type":"application/json"},credentials:"include",ignoreResponseError:!0,onResponse({response:S}){const O=S._data.data.classes;P.value=O||[]}});const a=(await c(`/task/get/id?idTask=${k}`,{method:"get",headers:{"Content-Type":"application/json"},credentials:"include"})).data.task;if(!a){await x.push("/panel/tasks/teacher");return}const n=(await c(`/task_class/get?idTask=${k}`,{method:"get",headers:{"Content-Type":"application/json"},credentials:"include"})).data.classes||[];n.length>0?h.value=!0:V(1);const i=(await c(`/user_task/get/idTask?idTask=${k}`,{method:"get",headers:{"Content-Type":"application/json"},credentials:"include"})).data.users||[];let R;if(n.length<=0&&!h.value)R=(await c("/user/get/role?role=student",{method:"get",headers:{"Content-Type":"application/json"},credentials:"include"})).data.users||[];else{const S=JSON.stringify(n);R=(await c(`/user_class/get/users?idClass=${S}`,{method:"get",headers:{"Content-Type":"application/json"},credentials:"include"})).data.users||[]}d.value=a,p.value=n,z.value=[...n],m.value=i,w.value=[...i],f.value=R}catch{await x.push("/panel/tasks/teacher")}H()}),se(g,t=>{t&&H()},{immediate:!0}),(t,a)=>{const u=Q,n=ne;return D(),le(n,{name:"panel",loading:!P.value||!d.value||!f.value},oe({header:_(()=>[v(ve,{links:[{name:"Úkoly",path:"/panel/tasks/teacher"},{name:"Přiřazení",path:`/panel/tasks/teacher/${N(k)}/assign`}]},null,8,["links"])]),_:2},[P.value&&d.value&&f.value?{name:"content",fn:_(()=>[e("div",he,[e("div",fe,[e("div",_e,[e("div",be,[e("h3",null,r(d.value.name),1),e("p",null,"Úkol ID: "+r(d.value.id),1),e("p",null,"Garant ID: "+r(d.value.guarantor),1),e("p",null,"Začátek: "+r(N(Y)(d.value.startDate).format("DD.MM. YYYY HH:MM")),1),e("p",null,"Konec: "+r(N(Y)(d.value.endDate).format("DD.MM. YYYY HH:MM")),1),e("p",null,"Nutné potvrzení: "+r(d.value.approve?"Ano":"Ne"),1),e("p",null,[a[0]||(a[0]=j(" Zadání: ")),e("a",{href:`http://89.203.248.163/uploads/tasks/${d.value.id}/${d.value.task}`,class:"link",download:"",target:"_blank"},r(d.value.task),9,ze)])])]),z.value.length<=0&&w.value.length<=0?(D(),M("div",we,[a[1]||(a[1]=e("div",{class:"section-head"},[e("h3",null,"Přiřazení pro (třídy/žáky)"),e("p",null,"Zde můžete přiřadit úkol buď celé třídě, nebo jednotlivým žákům. Vyberte požadovanou možnost v rozbalovacím menu níže.")],-1)),e("div",{class:F(["dropdown",{open:y.value}])},[e("div",{class:"title",onClick:W},[e("span",null,r(U.value),1),e("div",Ce,[v(u,{class:"icon",name:y.value?T.close:T.open},null,8,["name"])])]),I(e("div",Ie,[(D(!0),M(re,null,de(J.value,(l,i)=>(D(),M("div",{key:i,class:F([{selected:C.value===i},"section"]),onClick:R=>V(i)},[v(u,{class:"icon",name:C.value===i?T.select:T.selected},null,8,["name"]),e("span",null,r(l),1)],10,Ne))),128))],512),[[A,y.value]])],2)])):ie("",!0),I(e("div",Ae,[e("div",Pe,[e("h3",null,[a[2]||(a[2]=j(" Třídy ")),I(e("span",Te,"(aktualizováno)",512),[[A,JSON.stringify([...p.value||[]].sort())!==JSON.stringify([...z.value||[]].sort())]])]),a[3]||(a[3]=e("p",null,"Zde můžete upravit přiřazení tříd, kterým bude úkol zadán. Vyberte požadované třídy a potvrďte změny.",-1))]),v(ke,{"old-class-ids":p.value||[],classes:P.value||[],reset:$.value,onUpdate:L},null,8,["old-class-ids","classes","reset"])],512),[[A,h.value]]),I(e("div",Re,[e("div",Se,[e("h3",null,[a[4]||(a[4]=j(" Žáci ")),I(e("span",De,"(aktualizováno)",512),[[A,JSON.stringify([...m.value||[]].sort())!==JSON.stringify([...w.value||[]].sort())]])]),a[5]||(a[5]=e("p",null,"Vyberte žáky, kterým chcete úkol přiřadit, a potvrďte změny.",-1))]),v(N(ge),{rows:f.value,ref_key:"datatable",ref:g,columns:q.value,pageSize:10,sortable:!0,search:B.value,hasCheckbox:!0,onInput:G},{name:_(l=>[e("div",je,[e("img",{src:"http://89.203.248.163/uploads/profilePictures/"+l.value.profilePicture,alt:"User profile photo",loading:"lazy"},null,8,$e),e("p",null,r(l.value.name)+" "+r(l.value.surname),1)])]),abbreviation:_(l=>[e("p",Ee,r(l.value.abbreviation||"Není"),1)]),createdAt:_(l=>[e("p",null,r(N(Y)(l.value.createdAt).format("DD.MM. YYYY HH:MM")),1)]),_:1},8,["rows","columns","search"])],512),[[A,!h.value]]),v(ce,{"is-loading":b.value,"reset-function":E,"submit-function":K},{default:_(()=>a[6]||(a[6]=[j(" Pole označená * jsou povinná ")])),_:1},8,["is-loading"])]),v(me)])]),key:"0"}:void 0]),1032,["loading"])}}}),aa=ue(Me,[["__scopeId","data-v-098b60e9"]]);export{aa as default};
//# sourceMappingURL=DYaBjiG8.js.map
