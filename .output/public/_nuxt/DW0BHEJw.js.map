{"version":3,"file":"DW0BHEJw.js","sources":["../../../../pages/panel/index.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport Navbar from \"~/components/Navbar.vue\";\nimport { ref } from \"vue\";\nimport apiFetch from \"~/componsables/apiFetch\";\nimport moment from \"moment\";\nimport Navigation from \"~/components/basics/Navigation.vue\";\nimport Vue3Datatable from \"@bhplugin/vue3-datatable\";\nimport \"@bhplugin/vue3-datatable/dist/style.css\";\nimport type {TaskData} from \"~/types/tasks\";\nimport { useAccountStore } from \"~/stores/account\";\nimport { storeToRefs } from \"pinia\";\n\nuseHead({\n  title: \"Panel | Domů\",\n  meta: [{ name: \"description\", content: \"Panel Homepage\" }],\n});\n\nconst accountStore = useAccountStore();\nconst { getRole: role, getId: userId } = storeToRefs(accountStore);\nconst cols = ref<{ field: string; title: string; type?: string; width?: string; filter?: boolean; }[]>([\n  { field: \"id\", title: \"ID\", width: \"90px\", type: \"number\" },\n  { field: \"name\", title: \"Název\", type: \"string\" },\n  { field: \"startDate\", title: \"Začátek\", type: \"date\" },\n  { field: \"endDate\", title: \"Konec\", type: \"date\" },\n  { field: \"task\", title: \"Zadání\", type: \"string\" },\n  { field: \"actions\", title: \"Akce\" },\n]);\nconst allTasks = ref<TaskData[] | undefined>(undefined);\nconst searchInput = ref<string>(\"\");\nconst numbers = ref<{ students: number | null; classes: number | null; teachers: number | null }>({\n  students: null,\n  classes: null,\n  teachers: null,\n});\nconst navigationLinks = computed<{\n  name: string;\n  path?: string | undefined;\n  action?: Function | undefined;\n}[]>(() => {\n  if ([\"admin\", \"teacher\"].includes(role.value)) {\n    return [\n      { name: \"Vytvořené úkoly\", path: `/panel/tasks/${role.value}` },\n      { name: \"Žáci\", path: `/panel/users/student` },\n      { name: \"Změna hesla\", path: `/panel/settings/security` },\n    ];\n  }\n\n  return [\n    { name: \"Aktivní úkoly\", path: `/panel/tasks/${role.value}` },\n    { name: \"Učitelé\", path: `/panel/users/teacher` },\n    { name: \"Změna hesla\", path: `/panel/settings/security` },\n    { name: \"Vyhodnocené úkoly\", path: `/panel/tasks/${role.value}/evaluated` },\n  ];\n});\nconst infoCards = computed<{ title: string; icon: string; value: string | number; }[]>(() =>[\n  {\n    title: \"Počet studentů\",\n    icon: \"material-symbols:supervisor-account-rounded\",\n    value: numbers.value.students || -1,\n  },\n  {\n    title: \"Počet tříd\",\n    icon: \"material-symbols:flight-class-rounded\",\n    value: numbers.value.classes || -1,\n  },\n  {\n    title: \"Počet učitelů\",\n    icon: \"material-symbols:supervisor-account-rounded\",\n    value: numbers.value.teachers || -1,\n  },\n]);\n\nconst openTask = async (id: number): Promise<void> => {\n  if (!id) return;\n\n  await navigateTo(`/panel/tasks/${role.value}/${id}`);\n};\n\nonMounted(async (): Promise<void> => {\n  await apiFetch(\"/user/get/count/by-role?role=student\", {\n    method: \"get\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    credentials: \"include\",\n    ignoreResponseError: true,\n    onResponse({ response }) {\n      const count: number = response._data.data.count;\n\n      numbers.value.students = count || null;\n    },\n  });\n\n  await apiFetch(\"/user/get/count/by-role?role=teacher\", {\n    method: \"get\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    credentials: \"include\",\n    ignoreResponseError: true,\n    onResponse({ response }) {\n      const count: number = response._data.data.count;\n\n      numbers.value.teachers = count || null;\n    },\n  });\n\n  await apiFetch(\"/class/count\", {\n    method: \"get\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    credentials: \"include\",\n    ignoreResponseError: true,\n    onResponse({ response }) {\n      const count: number = response._data.data.count;\n\n      numbers.value.classes = count || null;\n    },\n  });\n\n  if ([\"admin\", \"teacher\"].includes(role.value)) {\n    await apiFetch(`/task/get/guarantor?idUser=${userId.value}`, {\n      method: \"get\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      credentials: \"include\",\n      ignoreResponseError: true,\n      onResponse({ response }) {\n        const tasks: TaskData[] = response._data.data.tasks.slice(0, 5) || [];\n\n        allTasks.value = tasks || [];\n      },\n    });\n    return;\n  }\n\n  await apiFetch(`/user_task/get/status?status=${encodeURIComponent(JSON.stringify([\"approved\"]))}&which=1`, {\n    method: \"get\",\n    credentials: \"include\",\n    ignoreResponseError: true,\n    onResponse({ response }) {\n      const tasks: TaskData[] = (response._data.data.elaboratingTasks || [])\n          .filter((task: any) => !task.review)\n          .slice(0, 5)\n          .map((task: any) => ({\n            ...task,\n            id: task.idTask\n          })) || [];\n\n      allTasks.value = tasks || [];\n    },\n  });\n})\n</script>\n\n<template>\n  <NuxtLayout name=\"panel\" :loading=\"!numbers.students || !numbers.classes || !numbers.teachers || !allTasks\">\n    <template #header>\n      <Navbar\n        :links=\"[\n          { name: 'Domů', path: '/panel'},\n        ]\"\n      />\n    </template>\n\n    <template #content v-if=\"allTasks\">\n      <div id=\"home\">\n        <div class=\"info\">\n          <div class=\"line\">\n            <div class=\"section-head\">\n              <h3>Informativní karty</h3>\n              <p>Informativní karty slouží k rychlému nalezení zajímavých údajů z panelu.</p>\n            </div>\n          </div>\n\n          <ul class=\"cards\">\n            <li class=\"card\" v-for=\"(data, index) in infoCards\" :key=\"index\">\n              <div class=\"content\">\n                <div class=\"data\">\n                  <h6>{{ data.title }}</h6>\n                  <p>{{ data.value }}</p>\n                </div>\n\n                <Icon class=\"icon\" :name=\"data.icon\"></Icon>\n              </div>\n            </li>\n          </ul>\n        </div>\n\n        <div class=\"line\">\n          <Navigation class=\"navigation\" title=\"Rychlé odkazy\" :active-link-id=\"-1\" :links=\"navigationLinks\" />\n\n          <div class=\"line\">\n            <div class=\"line\">\n              <div class=\"section-head\">\n                <h3>{{ [\"admin\", \"teacher\"].includes(role) ? \"Vytvořené úkoly\" : \"Rozpracované úkoly\" }}</h3>\n                <p>{{ [\"admin\", \"teacher\"].includes(role) ? \"Rychlý přístup do vašich vytvořených úkolů.\" : \"Rychlý přístup do vašich rozpracovaných úkolů.\" }}</p>\n              </div>\n\n              <div class=\"search\">\n                <input\n                  type=\"text\"\n                  name=\"searchInput\"\n                  placeholder=\"Hledat úkol\"\n                  v-model=\"searchInput\"\n                />\n                <Icon class=\"icon\" name=\"material-symbols:search-rounded\"></Icon>\n              </div>\n            </div>\n\n            <Vue3Datatable :pageSize=\"5\" :sortable=\"true\" :search=\"searchInput\" :pagination=\"false\" :rows=\"allTasks\" :columns=\"cols\">\n              <template #task=\"data\">\n                <a :href=\"`http://89.203.248.163/uploads/tasks/${data.value.id}/${data.value.task}`\" class=\"link\" download target=\"_blank\">\n                  {{ data.value.task }}\n                </a>\n              </template>\n\n              <template #startDate=\"data\">\n                <p>{{ moment(data.value.startDate).format(\"DD.MM. YYYY HH:MM\") }}</p>\n              </template>\n\n              <template #endDate=\"data\">\n                <p>{{ moment(data.value.endDate).format(\"DD.MM. YYYY HH:MM\") }}</p>\n              </template>\n\n              <template #approve=\"data\">\n                <p>{{ data.value.approve ? \"Ano\" : \"Ne\" }}</p>\n              </template>\n\n              <template #actions=\"data\">\n                <div class=\"actions\">\n                  <button type=\"button\" class=\"primary\" @click=\"openTask(data.value.id)\">Otevřít</button>\n                </div>\n              </template>\n            </Vue3Datatable>\n          </div>\n        </div>\n      </div>\n    </template>\n  </NuxtLayout>\n</template>\n\n<style lang=\"scss\" scoped>\n@use \"../../assets/style/datatable\";\n\n#home {\n  width: 100%;\n  display: flex;\n  flex-direction: column;\n  gap: 60px;\n  position: relative;\n\n  .section-head {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n\n    h3 {\n      font-weight: 700;\n      font-size: 20px;\n      color: var(--title-color);\n    }\n\n    p {\n      color: rgba(var(--description-color), 1);\n      font-size: 16px;\n    }\n  }\n\n  .link {\n    color: rgba(var(--main-color), 1);\n    text-decoration: none;\n    transition: 0.2s;\n\n    &:hover {\n      color: rgba(var(--main-color), 0.8);\n    }\n  }\n\n  .navigation {\n    height: fit-content;\n    min-width: 250px;\n  }\n\n  .actions {\n    display: flex;\n    flex-direction: row;\n    gap: 10px;\n\n    button {\n      padding: 10px 15px;\n      border-radius: var(--small-border-radius);\n      transition: 0.2s;\n      font-size: 16px;\n      background: var(--btn-2-background);\n      color: var(--btn-2-color);\n      border: var(--border-width) solid rgba(var(--border-color), 0.5);\n\n      &:hover {\n        background: var(--btn-2-hover-background);\n      }\n\n      &.primary {\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n        align-items: center;\n        background: var(--btn-1-background);\n        color: var(--btn-1-color);\n\n        &:hover {\n          background: var(--btn-1-hover-background);\n        }\n      }\n    }\n  }\n\n  .search {\n    min-width: 150px;\n    display: flex;\n    align-items: center;\n\n    input {\n      border: var(--border-width) solid rgba(var(--border-color), 0.5);\n      border-radius: var(--normal-border-radius);\n      font-size: 16px;\n      outline: none;\n      padding: 15px 40px 15px 15px;\n      width: 100%;\n      background: var(--input-background);\n      color: var(--input-color);\n\n      &:focus {\n        border-color: rgba(var(--main-color), 1);\n      }\n    }\n\n    .icon {\n      margin-left: -30px;\n      cursor: pointer;\n      color: rgba(var(--description-color), 1);\n      transition: 0.2s;\n      font-size: 16px;\n\n      &:hover {\n        color: var(--mini-title-color);\n      }\n    }\n  }\n\n  .line {\n    display: flex;\n    flex-direction: row;\n    align-items: flex-start;\n    justify-content: space-between;\n    flex-wrap: wrap;\n    gap: 30px;\n    width: 100%;\n    flex: 1;\n  }\n\n  .info {\n    display: flex;\n    flex-direction: column;\n    gap: 30px;\n\n    .cards {\n      display: flex;\n      flex-direction: row;\n      flex-wrap: wrap;\n      gap: 30px;\n      justify-content: flex-start;\n\n      .card {\n        border-radius: var(--normal-border-radius);\n        display: flex;\n        flex: 1;\n        gap: 30px;\n        flex-direction: column;\n        align-items: flex-start;\n        justify-content: space-between;\n        border: var(--border-width) solid rgba(var(--border-color), 0.5);\n        padding: 30px;\n        transition: 0.2s;\n        cursor: pointer;\n        min-width: 200px;\n        background: var(--card-1-background);\n\n        .icon {\n          font-size: 40px;\n        }\n\n        &:hover,\n        &.active {\n          background: var(--card-1-hover-background);\n        }\n\n        .content {\n          display: flex;\n          flex-direction: row;\n          gap: 20px;\n          align-items: center;\n          justify-content: space-between;\n          width: 100%;\n          flex-wrap: wrap;\n\n          .data {\n            display: flex;\n            flex-direction: column;\n            gap: 20px;\n            order: 0;\n\n            h6 {\n              color: rgba(var(--description-color), 1);\n              font-size: 16px;\n              font-weight: 600;\n            }\n\n            p {\n              color: var(--mini-title-color);\n              font-weight: 800;\n              font-size: 28px;\n            }\n          }\n\n          span {\n            font-size: 40px;\n            color: rgba(var(--description-color), 1);\n            order: 1;\n          }\n        }\n      }\n    }\n  }\n}\n\n@media (max-width: 1250px) {\n  #home .navigation {\n    flex: 1;\n  }\n}\n\n@media (max-width: 400px) {\n  #home .info .cards .card .content .data {\n    order: 2;\n  }\n}\n</style>\n"],"names":["useHead","accountStore","useAccountStore","role","userId","storeToRefs","cols","ref","allTasks","searchInput","numbers","navigationLinks","computed","infoCards","openTask","id","navigateTo","onMounted","apiFetch","response","count","tasks","task"],"mappings":"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"}