{"version":3,"file":"CsxiWtPL.js","sources":["../../../../pages/panel/users/[role]/remove.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { useRoute } from \"vue-router\";\r\nimport Navbar from \"../../../../components/Navbar.vue\";\r\nimport type { AccountData } from \"~/types/account\";\r\nimport { ref, onMounted } from \"vue\";\r\nimport apiFetch from \"../../../../componsables/apiFetch\";\r\nimport ActionBar from \"~/components/basics/ActionBar.vue\";\r\nimport UsersGrid from \"../../../../components/users/Grid.vue\";\r\nimport GridNavigation from \"../../../../components/users/Navigation.vue\";\r\nimport { useAlertsStore } from \"~/stores/alerts\";\r\nimport Alerts from \"../../../../components/Alerts.vue\";\r\nimport Loading from \"../../../../components/basics/Loading.vue\";\r\n\r\ndefinePageMeta({\r\n  roles: [\"admin\"],\r\n});\r\n\r\nconst route = useRoute();\r\nconst role = route.params.role as string;\r\n\r\nuseHead({\r\n  title: \"Panel | Odstranění uživatelů - \" + role,\r\n  meta: [{ name: \"description\", content: \"Panel Settings User Information\" }],\r\n});\r\n\r\nconst loading = ref<boolean>(false);\r\nconst alertsStore = useAlertsStore();\r\nconst users = ref<AccountData[] | null>(null);\r\nconst numberOfPages = ref<number>(0);\r\nconst activePage = ref<number>(0);\r\nconst selectedUsers = ref<AccountData[]>([]);\r\nconst resetSelectedUsers = ref<boolean>(false);\r\nconst searchInput = ref<string>(\"\");\r\nconst searchedUsers = ref<AccountData[]>([]);\r\n\r\nconst searchUsers = (): void => {\r\n  const inputToArray: string[] = searchInput.value.split(\" \");\r\n  const allSearchedUsers: AccountData[] = [];\r\n\r\n  if (!users.value) return;\r\n\r\n  users.value.forEach((user: AccountData) => {\r\n    const searchResult = [\r\n      user.name,\r\n      user.surname,\r\n      user.email,\r\n      user.abbreviation || \"\",\r\n    ].some((word: string) => {\r\n      let result: boolean = false;\r\n\r\n      inputToArray.forEach((inputWord: string) => {\r\n        result = word.toLowerCase().includes(inputWord.toLowerCase());\r\n      });\r\n\r\n      return result;\r\n    });\r\n\r\n    if (searchResult) allSearchedUsers.push(user);\r\n  });\r\n\r\n  searchedUsers.value = allSearchedUsers;\r\n};\r\n\r\nconst pingResetSelectedUsers = (): void => {\r\n  resetSelectedUsers.value = false;\r\n\r\n  setTimeout((): void => {\r\n    resetSelectedUsers.value = true;\r\n  }, 10);\r\n};\r\n\r\nconst removeUsers = async (): Promise<void> => {\r\n  if (!users.value || !selectedUsers.value) return;\r\n\r\n  loading.value = true;\r\n\r\n  await apiFetch(\"/user/delete\", {\r\n    method: \"delete\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: {\r\n      idUser: selectedUsers.value.map((user: AccountData) => user.id),\r\n    },\r\n    ignoreResponseError: true,\r\n    credentials: \"include\",\r\n    onResponse({ response }: any) {\r\n      const resCode: string = response._data.resCode.toString();\r\n\r\n      switch (resCode) {\r\n        case \"3010\":\r\n          alertsStore.addAlert({type: \"error\", title: \"Odstranění uživatelů\", message: \"Nedostatečné oprávnění pro odstranění uživatelů.\"});\r\n          break;\r\n        case \"3020\":\r\n          alertsStore.addAlert({type: \"warning\", title: \"Odstranění uživatelů\", message: \"Žádný uživatel nebyl vybrán.\"});\r\n          break;\r\n        case \"3030\":\r\n          alertsStore.addAlert({type: \"warning\", title: \"Odstranění uživatelů\", message: \"Nemůžete odstranit sám sebe.\"});\r\n          break;\r\n        case \"3040\":\r\n          alertsStore.addAlert({type: \"warning\", title: \"Odstranění uživatelů\", message: \"Žádný uživatel nebyl odstraněn.\"});\r\n          break;\r\n        case \"3051\":\r\n          alertsStore.addAlert({type: \"success\", title: \"Odstranění uživatelů\", message: `Uživatelé byli úspěšně odstraněni. (${response._data.data.deletedIds.length}/${selectedUsers.value.length})`});\r\n          if (users.value) {\r\n            users.value = users.value.filter((user: AccountData) => {\r\n              return !selectedUsers.value.some(\r\n                  (selectedUser: AccountData) => selectedUser.id === user.id\r\n              );\r\n            });\r\n\r\n            searchedUsers.value = [...users.value];\r\n            pingResetSelectedUsers();\r\n          }\r\n          break;\r\n        default:\r\n          alertsStore.addAlert({type: \"error\", title: \"Odstranění uživatelů\", message: \"Nastala neznámá chyba.\"});\r\n          break;\r\n      }\r\n    },\r\n    onRequestError() {\r\n      alertsStore.addAlert({type: \"error\", title: \"Odstranění uživatelů\", message: \"Nastala neznámá chyba.\",});\r\n    },\r\n  }).finally((): void => {\r\n    loading.value = false;\r\n  });\r\n};\r\n\r\nonMounted(async (): Promise<void> => {\r\n  await apiFetch(`/user/get/role?role=${encodeURIComponent(role)}`, {\r\n    method: \"get\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    credentials: \"include\",\r\n    ignoreResponseError: true,\r\n    onResponse({ response }: any) {\r\n      const usersData: AccountData[] = response._data?.data?.users || [];\r\n\r\n      users.value = usersData;\r\n      searchedUsers.value = [...usersData];\r\n    },\r\n  });\r\n});\r\n</script>\r\n\r\n<template>\r\n  <NuxtLayout name=\"panel\" :loading=\"!users\">\r\n    <template #header>\r\n      <Navbar\r\n        :links=\"[\r\n          { name: 'Uživatelé', path: '/panel/users' },\r\n          { name: role, path: '/panel/users/' + role },\r\n          { name: 'Odstranění', path: '/panel/users/' + role + '/remove' },\r\n        ]\"\r\n      />\r\n    </template>\r\n\r\n    <template #content v-if=\"users\">\r\n      <div id=\"users\">\r\n        <div class=\"content\">\r\n          <ActionBar\r\n            class=\"action-bar\"\r\n            description=\"Správa uživatelů\"\r\n            :active=\"2\"\r\n            :texts=\"['Přidat', 'Upravit', 'Odebrat']\"\r\n            :icons=\"[\r\n              'material-symbols:add-rounded',\r\n              'material-symbols:edit-rounded',\r\n              'material-symbols:delete-rounded',\r\n            ]\"\r\n            :navigate-to=\"[\r\n              `/panel/users/add`,\r\n              `/panel/users/${role}/edit`,\r\n              `/panel/users/${role}/remove`,\r\n            ]\"\r\n          />\r\n\r\n          <div class=\"line\">\r\n            <div class=\"section-head\">\r\n              <h3>\r\n                Uživatelé: {{ selectedUsers.length }} / {{ searchedUsers.length }}\r\n              </h3>\r\n              <p>Vyberte uživatele, které chcete odstranit, nebo použijte vyhledávání pro zúžení výběru.</p>\r\n            </div>\r\n\r\n            <div class=\"search\">\r\n              <input\r\n                type=\"text\"\r\n                name=\"searchInput\"\r\n                placeholder=\"Hledat uživatele\"\r\n                @input=\"searchUsers\"\r\n                v-model=\"searchInput\"\r\n              />\r\n              <Icon class=\"icon\" name=\"material-symbols:search-rounded\"></Icon>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"buttons\">\r\n            <button class=\"remove\" @click=\"removeUsers\">\r\n              Odstranit\r\n              <Loading\r\n                v-show=\"loading\"\r\n                size=\"5px\"\r\n                color=\"var(--actionBar-actions-remove-color)\"\r\n              />\r\n            </button>\r\n            <button class=\"reset\" @click=\"pingResetSelectedUsers\">\r\n              Zrušit vše\r\n            </button>\r\n          </div>\r\n\r\n          <div class=\"users\">\r\n            <UsersGrid\r\n              :users=\"searchedUsers\"\r\n              :users-per-page=\"12\"\r\n              :action=\"'remove'\"\r\n              :active-page=\"activePage\"\r\n              :reset=\"resetSelectedUsers\"\r\n              @get:number-of-pages=\"(value) => (numberOfPages = value)\"\r\n              @get:selected-users=\"(value) => (selectedUsers = value)\"\r\n            />\r\n            <GridNavigation\r\n              class=\"users-navigation\"\r\n              :number-of-pages=\"numberOfPages\"\r\n              @get:active-page=\"(value) => (activePage = value)\"\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <Alerts />\r\n      </div>\r\n    </template>\r\n  </NuxtLayout>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n.action-bar {\r\n  height: 80px;\r\n}\r\n\r\n#users {\r\n  display: flex;\r\n  flex-direction: row;\r\n  gap: 30px;\r\n  position: relative;\r\n  min-height: calc(100vh - 140px);\r\n  height: 100%;\r\n\r\n  .content {\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 35px;\r\n    position: relative;\r\n\r\n    .line {\r\n      display: flex;\r\n      flex-direction: row;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      flex-wrap: wrap;\r\n      gap: 30px;\r\n      width: 100%;\r\n    }\r\n\r\n    .search {\r\n      min-width: 150px;\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      input {\r\n        border: var(--border-width) solid rgba(var(--border-color), 0.5);\r\n        border-radius: var(--normal-border-radius);\r\n        font-size: 16px;\r\n        outline: none;\r\n        padding: 15px 40px 15px 15px;\r\n        width: 100%;\r\n        background: var(--input-background);\r\n        color: var(--input-color);\r\n\r\n        &:focus {\r\n          border-color: rgba(var(--main-color), 1);\r\n        }\r\n      }\r\n\r\n      .icon {\r\n        margin-left: -30px;\r\n        cursor: pointer;\r\n        color: rgba(var(--description-color), 1);\r\n        transition: 0.2s;\r\n        font-size: 16px;\r\n\r\n        &:hover {\r\n          color: var(--mini-title-color);\r\n        }\r\n      }\r\n    }\r\n\r\n    .buttons {\r\n      display: flex;\r\n      gap: 10px;\r\n\r\n      button {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        flex-direction: column;\r\n        gap: 5px;\r\n        padding: 10px 15px;\r\n        border-radius: var(--small-border-radius);\r\n        border: var(--border-width) solid transparent;\r\n        transition: 0.2s;\r\n        font-size: 16px;\r\n\r\n        &.remove {\r\n          color: var(--actionBar-actions-remove-color);\r\n          background: rgba(var(--actionBar-actions-remove-background), 1);\r\n          border-color: rgba(var(--actionBar-actions-remove-border), 1);\r\n\r\n          &:hover {\r\n            background: rgba(var(--actionBar-actions-remove-background), 0.8);\r\n          }\r\n        }\r\n\r\n        &.reset {\r\n          background: var(--btn-2-background);\r\n          color: var(--btn-2-color);\r\n          border-color: rgba(var(--border-color), 0.5);\r\n\r\n          &:hover {\r\n            background: var(--btn-2-hover-background);\r\n          }\r\n        }\r\n\r\n        .icon {\r\n          font-size: 16px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .users {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 30px;\r\n      justify-content: space-between;\r\n      height: 100%;\r\n    }\r\n\r\n    .page-section {\r\n      border-bottom: 1px solid rgba(var(--border-color), 0.5);\r\n      padding-bottom: 35px;\r\n    }\r\n\r\n    .section-head {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 10px;\r\n\r\n      h3 {\r\n        font-weight: 600;\r\n        font-size: 20px;\r\n        color: var(--title-color);\r\n      }\r\n\r\n      h4 {\r\n        font-weight: 600;\r\n        font-size: 16px;\r\n        color: var(--title-color);\r\n      }\r\n\r\n      p {\r\n        color: rgba(var(--description-color), 1);\r\n        font-size: 16px;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n@media (max-width: 545px) {\r\n  .action-bar {\r\n    height: auto;\r\n  }\r\n}\r\n</style>\r\n"],"names":["role","useRoute","useHead","loading","ref","alertsStore","useAlertsStore","users","numberOfPages","activePage","selectedUsers","resetSelectedUsers","searchInput","searchedUsers","searchUsers","inputToArray","allSearchedUsers","user","word","result","inputWord","pingResetSelectedUsers","removeUsers","apiFetch","response","selectedUser","onMounted","usersData","_b","_a"],"mappings":"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"}