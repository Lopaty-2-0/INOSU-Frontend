{"version":3,"file":"zhmmrvL4.js","sources":["../../../../pages/panel/settings/index.vue"],"sourcesContent":["<script lang=\"ts\" setup>\r\nimport EditProfilePicture from \"~/components/manage/ProfilePicture.vue\";\r\nimport EditFormFooter from \"~/components/manage/Footer.vue\";\r\nimport Navigation from \"~/components/basics/Navigation.vue\";\r\nimport Alerts from \"~/components/Alerts.vue\";\r\nimport Navbar from \"~/components/Navbar.vue\";\r\nimport { ref, computed } from \"vue\";\r\nimport {storeToRefs} from \"pinia\";\r\nimport {useAccountStore} from \"~/stores/account\";\r\nimport apiFetch from \"../../../componsables/apiFetch\";\r\nimport {useAlertsStore} from \"~/stores/alerts\";\r\n\r\nuseHead({\r\n  title: \"Panel | Nastavení - Profil\",\r\n  meta: [\r\n    { name: \"description\", content: \"Panel Settings User Information\" }\r\n  ],\r\n});\r\n\r\nconst alertsStore = useAlertsStore();\r\nconst accountStore = useAccountStore();\r\nconst { getAccountData: accountData } = storeToRefs(accountStore);\r\n\r\nconst submitLoading = ref<boolean>(false);\r\nconst triggerReset = ref<boolean>(false);\r\n\r\nconst oldUserData = computed<{ profilePicture: string}>(() => ({\r\n  profilePicture: \"http://89.203.248.163/uploads/profilePictures/\" + accountData.value.profilePicture,\r\n}));\r\n\r\nconst newUserData = ref<{ profilePicture: File | undefined }>({\r\n  profilePicture: undefined,\r\n});\r\n\r\nconst onProfilePictureUpdate = (updatedUserData: { profilePicture: File | undefined }): void => {\r\n  newUserData.value.profilePicture = updatedUserData.profilePicture;\r\n};\r\n\r\nconst resetUserData = (): void => {\r\n  newUserData.value = {\r\n    profilePicture: undefined,\r\n  };\r\n\r\n  triggerReset.value = true;\r\n\r\n  setTimeout((): void => {\r\n    triggerReset.value = false;\r\n  }, 100);\r\n};\r\n\r\nconst updateUserData = async (): Promise<void> => {\r\n  submitLoading.value = true;\r\n\r\n  if (newUserData.value.profilePicture) {\r\n    const updateProfileForm: FormData = new FormData();\r\n\r\n    updateProfileForm.append(\"profilePicture\", newUserData.value.profilePicture);\r\n\r\n    await apiFetch(\"/user/update\", {\r\n      method: \"PUT\",\r\n      body: updateProfileForm,\r\n      credentials: \"include\",\r\n      ignoreResponseError: true,\r\n      async onResponse({ response }) {\r\n        const resCode: string = response._data.resCode.toString();\r\n        const data = response._data.data;\r\n\r\n        switch (resCode) {\r\n          case \"2010\":\r\n            alertsStore.addAlert({ type: \"error\", title: \"Změna profilu\", message: \"Profilová fotka nebyla zadána.\" });\r\n            break;\r\n          case \"2020\":\r\n            alertsStore.addAlert({ type: \"error\", title: \"Změna profilu\", message: \"Nepodporovaný formát obrázku.\" });\r\n            break;\r\n          case \"2031\":\r\n            alertsStore.addAlert({ type: \"success\", title: \"Změna profilu\", message: \"Profilový obrázek byl aktualizován.\" });\r\n            accountStore.updateProfilePicture(data.user.profilePicture);\r\n            newUserData.value.profilePicture = undefined;\r\n            break;\r\n          default:\r\n            alertsStore.addAlert({ type: \"error\", title: \"Změna profilu\", message: \"Nastala neznámá chyba.\" });\r\n            break;\r\n        }\r\n      },\r\n      async onRequestError() {\r\n        alertsStore.addAlert({ type: \"error\", title: \"Změna profilu\", message: \"Nastala neznámá chyba.\" });\r\n      }\r\n    });\r\n  }\r\n\r\n  submitLoading.value = false;\r\n};\r\n</script>\r\n\r\n<template>\r\n  <NuxtLayout name=\"panel\">\r\n    <template #header>\r\n      <Navbar :links=\"[\r\n        { name: 'Nastavení', path: '/panel/settings' },\r\n        { name: 'Profil', path: '/panel/settings' },\r\n      ]\" />\r\n    </template>\r\n\r\n    <template #content>\r\n      <div id=\"settings\">\r\n        <Navigation class=\"navigation\" title=\"Nastavení\" :active-link-id=\"0\" :links=\"[\r\n          { name: 'Profil', path: '/panel/settings' },\r\n          { name: 'Zabezpečení', path: '/panel/settings/security' },\r\n          { name: 'Přizpůsobení', path: '/panel/settings/customization' },\r\n        ]\" />\r\n\r\n        <div class=\"content\">\r\n          <EditProfilePicture class=\"page-section\" :old-profile-picture=\"oldUserData.profilePicture\" @update=\"onProfilePictureUpdate\" :reset=\"triggerReset\">\r\n            <div class=\"section-head\">\r\n              <h3>\r\n                Profilová fotka\r\n                <span class=\"update\" v-show=\"newUserData.profilePicture\">(aktualizováno)</span>\r\n              </h3>\r\n              <p>Změňte svůj profilový obrázek</p>\r\n            </div>\r\n          </EditProfilePicture>\r\n\r\n          <EditFormFooter :submit-function=\"updateUserData\" :reset-function=\"resetUserData\" :is-loading=\"submitLoading\" />\r\n        </div>\r\n\r\n        <Alerts/>\r\n      </div>\r\n    </template>\r\n  </NuxtLayout>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n#settings {\r\n  display: flex;\r\n  flex-direction: row;\r\n  gap: 30px;\r\n  position: relative;\r\n\r\n  .navigation {\r\n    height: fit-content;\r\n    position: sticky;\r\n    top: 110px;\r\n    min-width: 300px;\r\n  }\r\n\r\n  .content {\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 35px;\r\n    position: relative;\r\n\r\n    .page-section {\r\n      border-bottom: 1px solid rgba(var(--border-color), 0.5);\r\n      padding-bottom: 35px;\r\n    }\r\n\r\n    .section-head {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 10px;\r\n\r\n      h3 {\r\n        font-weight: 600;\r\n        font-size: 20px;\r\n        color: var(--title-color);\r\n      }\r\n\r\n      p {\r\n        color: rgba(var(--description-color), 1);\r\n        font-size: 16px;\r\n      }\r\n\r\n      .update {\r\n        color: rgba(var(--error-color), 1);\r\n      }\r\n    }\r\n\r\n    .password-rules {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 10px;\r\n\r\n      h4 {\r\n        font-weight: 600;\r\n        font-size: 16px;\r\n        color: var(--title-color);\r\n        margin-top: 10px;\r\n      }\r\n\r\n      ul {\r\n        list-style: none;\r\n\r\n        li {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 10px;\r\n          font-size: 16px;\r\n          color: rgba(var(--description-color), 1);\r\n          margin-bottom: 10px;\r\n\r\n          .icon {\r\n            color: rgba(var(--main-color), 1);\r\n            line-height: 0;\r\n          }\r\n        }\r\n\r\n        p {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 5px;\r\n\r\n          .icon {\r\n            padding-left: 5px;\r\n            color: rgba(var(--success-color), 1);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    ::v-deep(.reset-password) {\r\n      flex-direction: column;\r\n    }\r\n\r\n    ::v-deep(.section) {\r\n      width: 100%;\r\n    }\r\n  }\r\n}\r\n\r\n@media (max-width: 1055px) {\r\n  #settings {\r\n    flex-direction: column;\r\n    gap: 30px;\r\n\r\n    .navigation {\r\n      width: 100%;\r\n      position: relative;\r\n      top: 0;\r\n      min-width: 200px;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"],"names":["useHead","alertsStore","useAlertsStore","accountStore","useAccountStore","accountData","storeToRefs","submitLoading","ref","triggerReset","oldUserData","computed","newUserData","onProfilePictureUpdate","updatedUserData","resetUserData","updateUserData","updateProfileForm","apiFetch","response","resCode","data"],"mappings":"6mBAYQA,EAAA,CACN,MAAO,6BACP,KAAM,CACJ,CAAE,KAAM,cAAe,QAAS,iCAAkC,CAAA,CACpE,CACD,EAED,MAAMC,EAAcC,EAAe,EAC7BC,EAAeC,EAAgB,EAC/B,CAAE,eAAgBC,GAAgBC,EAAYH,CAAY,EAE1DI,EAAgBC,EAAa,EAAK,EAClCC,EAAeD,EAAa,EAAK,EAEjCE,EAAcC,EAAoC,KAAO,CAC7D,eAAgB,iDAAmDN,EAAY,MAAM,cAAA,EACrF,EAEIO,EAAcJ,EAA0C,CAC5D,eAAgB,MAAA,CACjB,EAEKK,EAA0BC,GAAgE,CAClFF,EAAA,MAAM,eAAiBE,EAAgB,cACrD,EAEMC,EAAgB,IAAY,CAChCH,EAAY,MAAQ,CAClB,eAAgB,MAClB,EAEAH,EAAa,MAAQ,GAErB,WAAW,IAAY,CACrBA,EAAa,MAAQ,IACpB,GAAG,CACR,EAEMO,EAAiB,SAA2B,CAG5C,GAFJT,EAAc,MAAQ,GAElBK,EAAY,MAAM,eAAgB,CAC9B,MAAAK,EAA8B,IAAI,SAExCA,EAAkB,OAAO,iBAAkBL,EAAY,MAAM,cAAc,EAE3E,MAAMM,EAAS,eAAgB,CAC7B,OAAQ,MACR,KAAMD,EACN,YAAa,UACb,oBAAqB,GACrB,MAAM,WAAW,CAAE,SAAAE,GAAY,CAC7B,MAAMC,EAAkBD,EAAS,MAAM,QAAQ,SAAS,EAClDE,EAAOF,EAAS,MAAM,KAE5B,OAAQC,EAAS,CACf,IAAK,OACSnB,EAAA,SAAS,CAAE,KAAM,QAAS,MAAO,gBAAiB,QAAS,iCAAkC,EACzG,MACF,IAAK,OACSA,EAAA,SAAS,CAAE,KAAM,QAAS,MAAO,gBAAiB,QAAS,gCAAiC,EACxG,MACF,IAAK,OACSA,EAAA,SAAS,CAAE,KAAM,UAAW,MAAO,gBAAiB,QAAS,sCAAuC,EACnGE,EAAA,qBAAqBkB,EAAK,KAAK,cAAc,EAC1DT,EAAY,MAAM,eAAiB,OACnC,MACF,QACcX,EAAA,SAAS,CAAE,KAAM,QAAS,MAAO,gBAAiB,QAAS,yBAA0B,EACjG,KAAA,CAEN,EACA,MAAM,gBAAiB,CACTA,EAAA,SAAS,CAAE,KAAM,QAAS,MAAO,gBAAiB,QAAS,yBAA0B,CAAA,CACnG,CACD,CAAA,CAGHM,EAAc,MAAQ,EACxB"}