{"version":3,"file":"MgSo4-XP.js","sources":["../../../../pages/panel/classes/remove.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport Navbar from \"~/components/Navbar.vue\";\r\nimport Alerts from \"~/components/Alerts.vue\";\r\nimport Vue3Datatable from \"@bhplugin/vue3-datatable\";\r\nimport \"@bhplugin/vue3-datatable/dist/style.css\";\r\nimport ActionBar from \"~/components/basics/ActionBar.vue\";\r\nimport apiFetch from \"~/componsables/apiFetch\";\r\nimport type {ClassData} from \"~/types/classes\";\r\nimport {ref} from \"vue\";\r\nimport Loading from \"~/components/basics/Loading.vue\";\r\nimport { useAlertsStore } from \"~/stores/alerts\";\r\n\r\nuseHead({\r\n  title: \"Panel | Třídy - Odstranění\",\r\n  meta: [{ name: \"description\", content: \"Panel Homepage\" }],\r\n});\r\n\r\ndefinePageMeta({\r\n  roles: [\"admin\"],\r\n});\r\n\r\nconst alertsStore = useAlertsStore();\r\nconst cols = ref<{ field: string; title: string; type?: string; width?: string; filter?: boolean; }[]>([\r\n  { field: \"id\", title: \"ID\", width: \"90px\", type: \"number\" },\r\n  { field: \"name\", title: \"Název\", type: \"string\" },\r\n  { field: \"class\", title: \"Třída\", type: \"string\" },\r\n  { field: \"grade\", title: \"Ročník\", type: \"number\" },\r\n  { field: \"group\", title: \"Skupina\", type: \"string\" },\r\n  { field: \"specialization\", title: \"Zaměření\", type: \"string\" },\r\n]);\r\nconst datatable = ref<any>(null);\r\nconst allClasses = ref<ClassData[] | undefined>(undefined);\r\nconst selectedClasses = ref<ClassData[]>([]);\r\nconst loading = ref<boolean>(false);\r\nconst searchInput = ref<string>(\"\");\r\n\r\nconst pingResetSelectedClasses = (): void => {\r\n  datatable.value.clearSelectedRows();\r\n  selectedClasses.value = [];\r\n};\r\n\r\nconst onCheckboxSelect = (): void => {\r\n  if (!datatable.value) return;\r\n\r\n  setTimeout((): void => {\r\n    selectedClasses.value = datatable.value.getSelectedRows() as ClassData[];\r\n  }, 0);\r\n};\r\n\r\nconst removeClasses = async (): Promise<void> => {\r\n  loading.value = true;\r\n\r\n  await apiFetch(\"/class/delete\", {\r\n    method: \"delete\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    body: {\r\n      idClass : selectedClasses.value.map((oneClass: ClassData) => oneClass.id),\r\n    },\r\n    ignoreResponseError: true,\r\n    credentials: \"include\",\r\n    onResponse({ response }: any) {\r\n      const resCode: string = response._data.resCode.toString();\r\n\r\n\r\n      switch (resCode) {\r\n        case \"9010\":\r\n          alertsStore.addAlert({type: \"error\", title: \"Odstranění tříd\", message: \"Nedostatečné oprávnění pro odstranění tříd.\",});\r\n          break;\r\n        case \"9020\":\r\n          alertsStore.addAlert({type: \"warning\", title: \"Odstranění tříd\", message: \"Žádná třída nebyla vybrána.\",});\r\n          break;\r\n        case \"9031\":\r\n          if ((response._data.data.taskIds || []).length >= 1) {\r\n            alertsStore.addAlert({type: \"warning\", title: \"Odstranění tříd\", message: `Některé třídy nebyly odstraněny. Tyto třídy jsou přiřazeny k nějakému úkolu: ${response._data.data.taskIds.join(\", \")}`});\r\n          } else if ((response._data.data.userIds || []).length >= 1) {\r\n            alertsStore.addAlert({type: \"warning\", title: \"Odstranění tříd\", message: `Některé třídy nebyly odstraněny. Tyto třídy obsahují nějaké uživatele: ${response._data.data.userIds.join(\", \")}`});\r\n          } else {\r\n            alertsStore.addAlert({type: \"success\", title: \"Odstranění tříd\", message: `Třídy byly úspěšně odstraněny. (${response._data.data.goodIds.length}/${selectedClasses.value.length})`});\r\n          }\r\n\r\n          allClasses.value = allClasses.value?.filter((oneClass: ClassData) => !response._data.data.goodIds.includes(oneClass.id));\r\n\r\n          pingResetSelectedClasses();\r\n          break;\r\n        default:\r\n          alertsStore.addAlert({type: \"error\", title: \"Odstranění tříd\", message: \"Nastala neznámá chyba.\",});\r\n          break;\r\n      }\r\n    },\r\n    onRequestError() {\r\n      alertsStore.addAlert({type: \"error\", title: \"Odstranění tříd\", message: \"Nastala neznámá chyba.\",});\r\n    },\r\n  }).finally((): void => {\r\n    loading.value = false;\r\n  });\r\n}\r\n\r\nonMounted(async (): Promise<void> => {\r\n  await apiFetch(\"/class/get\", {\r\n    method: \"get\",\r\n    headers: {\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n    credentials: \"include\",\r\n    ignoreResponseError: true,\r\n    onResponse({ response }) {\r\n      const classes: ClassData[] = response._data.data.classes;\r\n\r\n      allClasses.value = classes || [];\r\n    },\r\n  });\r\n});\r\n</script>\r\n\r\n<template>\r\n  <NuxtLayout name=\"panel\" :loading=\"!allClasses\">\r\n    <template #header>\r\n      <Navbar\r\n        :links=\"[\r\n          { name: 'Třídy', path: '/panel/classes' },\r\n          { name: 'Odstranění', path: '/panel/classes/remove' },\r\n        ]\"\r\n      />\r\n    </template>\r\n\r\n    <template #content v-if=\"allClasses\">\r\n      <div id=\"classes\">\r\n        <div class=\"content\">\r\n          <ActionBar\r\n            class=\"action-bar\"\r\n            description=\"Správa tříd\"\r\n            :texts=\"['Přidat', 'Odebrat']\"\r\n            :actions=\"['add', 'remove']\"\r\n            :icons=\"[\r\n              'material-symbols:add-rounded',\r\n              'material-symbols:delete-rounded',\r\n            ]\"\r\n            :active=\"1\"\r\n            :navigate-to=\"[\r\n              `/panel/classes/add`,\r\n              `/panel/classes/remove`,\r\n            ]\"\r\n          />\r\n\r\n          <div class=\"line\">\r\n            <div class=\"section-head\">\r\n              <h3>Třídy: {{ selectedClasses.length }} / {{ allClasses.length }}</h3>\r\n              <p>Vyberte třídy, které chcete trvale odstranit ze systému.</p>\r\n            </div>\r\n\r\n            <div class=\"search\">\r\n              <input\r\n                type=\"text\"\r\n                name=\"searchInput\"\r\n                placeholder=\"Hledat třídy\"\r\n                v-model=\"searchInput\"\r\n              />\r\n              <Icon class=\"icon\" name=\"material-symbols:search-rounded\"></Icon>\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"buttons\">\r\n            <button class=\"remove\" @click=\"removeClasses\">\r\n              Odstranit\r\n              <Loading\r\n                v-show=\"loading\"\r\n                size=\"5px\"\r\n                color=\"var(--actionBar-actions-remove-color)\"\r\n              />\r\n            </button>\r\n            <button class=\"reset\" @click=\"pingResetSelectedClasses\">\r\n              Zrušit vše\r\n            </button>\r\n          </div>\r\n\r\n          <Vue3Datatable ref=\"datatable\" :rows=\"allClasses\" :columns=\"cols\" :hasCheckbox=\"true\" :pageSize=\"10\" :sortable=\"true\" :search=\"searchInput\" @input=\"onCheckboxSelect\">\r\n            <template #group=\"data\">\r\n              <p>\r\n                {{ data.value.group }}\r\n              </p>\r\n            </template>\r\n\r\n            <template #specialization=\"data\">\r\n              <p>\r\n                {{ data.value.specialization }}\r\n              </p>\r\n            </template>\r\n\r\n            <template #class=\"data\">\r\n              <p>\r\n                {{ data.value.specialization }}{{ data.value.grade }}{{ data.value.group }}\r\n              </p>\r\n            </template>\r\n          </Vue3Datatable>\r\n        </div>\r\n      </div>\r\n      <Alerts />\r\n    </template>\r\n  </NuxtLayout>\r\n</template>\r\n\r\n<style lang=\"scss\" scoped>\r\n@use \"../../../assets/style/datatable\";\r\n\r\n::v-deep(.bh-datatable .bh-table-responsive tr td p) {\r\n  text-transform: uppercase;\r\n}\r\n\r\n#classes {\r\n  display: flex;\r\n  flex-direction: row;\r\n  gap: 30px;\r\n  position: relative;\r\n\r\n  .content {\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 35px;\r\n    position: relative;\r\n\r\n    .error {\r\n      color: rgba(var(--error-color), 1);\r\n      font-size: 16px;\r\n    }\r\n\r\n    .line {\r\n      display: flex;\r\n      flex-direction: row;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      flex-wrap: wrap;\r\n      gap: 30px;\r\n      width: 100%;\r\n    }\r\n\r\n    .search {\r\n      min-width: 150px;\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      input {\r\n        border: var(--border-width) solid rgba(var(--border-color), 0.5);\r\n        border-radius: var(--normal-border-radius);\r\n        font-size: 16px;\r\n        outline: none;\r\n        padding: 15px 40px 15px 15px;\r\n        width: 100%;\r\n        background: var(--input-background);\r\n        color: var(--input-color);\r\n\r\n        &:focus {\r\n          border-color: rgba(var(--main-color), 1);\r\n        }\r\n      }\r\n\r\n      .icon {\r\n        margin-left: -30px;\r\n        cursor: pointer;\r\n        color: rgba(var(--description-color), 1);\r\n        transition: 0.2s;\r\n        font-size: 16px;\r\n\r\n        &:hover {\r\n          color: var(--mini-title-color);\r\n        }\r\n      }\r\n    }\r\n\r\n    .buttons {\r\n      display: flex;\r\n      gap: 10px;\r\n\r\n      button {\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        flex-direction: column;\r\n        gap: 5px;\r\n        padding: 10px 15px;\r\n        border-radius: var(--small-border-radius);\r\n        border: var(--border-width) solid transparent;\r\n        transition: 0.2s;\r\n        font-size: 16px;\r\n\r\n        &.remove {\r\n          color: var(--actionBar-actions-remove-color);\r\n          background: rgba(var(--actionBar-actions-remove-background), 1);\r\n          border-color: rgba(var(--actionBar-actions-remove-border), 1);\r\n\r\n          &:hover {\r\n            background: rgba(var(--actionBar-actions-remove-background), 0.8);\r\n          }\r\n        }\r\n\r\n        &.reset {\r\n          background: var(--btn-2-background);\r\n          color: var(--btn-2-color);\r\n          border-color: rgba(var(--border-color), 0.5);\r\n\r\n          &:hover {\r\n            background: var(--btn-2-hover-background);\r\n          }\r\n        }\r\n\r\n        .icon {\r\n          font-size: 16px;\r\n        }\r\n      }\r\n    }\r\n\r\n    .page-section {\r\n      border-bottom: 1px solid rgba(var(--border-color), 0.5);\r\n      padding-bottom: 35px;\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 20px;\r\n    }\r\n\r\n    .section-head {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 10px;\r\n\r\n      h3 {\r\n        font-weight: 600;\r\n        font-size: 20px;\r\n        color: var(--title-color);\r\n      }\r\n\r\n      p {\r\n        color: rgba(var(--description-color), 1);\r\n        font-size: 16px;\r\n      }\r\n\r\n      .update {\r\n        color: rgba(var(--error-color), 1);\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n@media (max-width: 1055px) {\r\n  #classes {\r\n    flex-direction: column;\r\n    gap: 30px;\r\n  }\r\n}\r\n</style>\r\n"],"names":["useHead","alertsStore","useAlertsStore","cols","ref","datatable","allClasses","selectedClasses","loading","searchInput","pingResetSelectedClasses","onCheckboxSelect","removeClasses","apiFetch","oneClass","response","_a","onMounted","classes"],"mappings":"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"}