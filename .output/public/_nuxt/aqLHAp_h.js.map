{"version":3,"file":"aqLHAp_h.js","sources":["../../../../pages/panel/settings/security.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport EditPassword from \"~/components/manage/Password.vue\";\nimport EditFormFooter from \"~/components/manage/Footer.vue\";\nimport Navigation from \"~/components/basics/Navigation.vue\";\nimport Alerts from \"~/components/Alerts.vue\";\nimport Navbar from \"~/components/Navbar.vue\";\nimport { ref } from \"vue\";\nimport apiFetch from \"../../../componsables/apiFetch\";\nimport { useAlertsStore } from \"~/stores/alerts\";\n\nuseHead({\n  title: \"Panel | Nastavení - Zabezpečení\",\n  meta: [\n    { name: \"description\", content: \"Panel Settings User Information\" }\n  ],\n});\n\nconst alertsStore = useAlertsStore();\n\nconst submitLoading = ref<boolean>(false);\nconst triggerReset = ref<boolean>(false);\n\nconst passwordRulesCheck = ref<boolean[]>([false, false, false, false]);\nconst userData = ref<{ passwords: { old: string, new: string } }>({\n  passwords: {\n    old: \"\",\n    new: \"\"\n  }\n});\n\nconst checkPasswordRules = (): void => {\n  passwordRulesCheck.value[0] = userData.value.passwords.new.length >= 5; // Check if password length is at least 5 characters\n\n  // Reset password rules check if password length is less than 6 characters\n  if (!passwordRulesCheck.value[0]) {\n    passwordRulesCheck.value = [false, false, false, false];\n    return;\n  }\n\n  passwordRulesCheck.value[1] = !!(userData.value.passwords.new.match(/[A-Z]/g) && userData.value.passwords.new.match(/[a-z]/g) && userData.value.passwords.new.match(/[0-9]/g)); // Check if password contains 2-3 characters: uppercase, lowercase, numbers\n  passwordRulesCheck.value[2] = !!userData.value.passwords.new.match(/[@#$%&*+=]/g); // Check if password contains at least 1 special character: @, #, $, %, &, *, +, =\n  passwordRulesCheck.value[3] = !userData.value.passwords.new.match(/\\s/g); // Check if password doesn't contain any spaces\n};\n\nconst onPasswordsUpdate = (passwordsInputs: { old: string | undefined, new: string | undefined }): void => {\n  if (!passwordsInputs.old || !passwordsInputs.new) {\n    userData.value.passwords.old = \"\";\n    userData.value.passwords.new = \"\";\n    return;\n  }\n\n  userData.value.passwords = {\n    old: passwordsInputs.old,\n    new: passwordsInputs.new\n  };\n\n  checkPasswordRules();\n};\n\nconst resetUserData = (): void => {\n  userData.value = {\n    passwords: {\n      old: \"\",\n      new: \"\"\n    }\n  };\n\n  passwordRulesCheck.value = [false, false, false, false];\n  triggerReset.value = true;\n\n  setTimeout((): void => {\n    triggerReset.value = false;\n  }, 100);\n};\n\nconst updateUserData = async (): Promise<void> => {\n  submitLoading.value = true;\n\n  if (userData.value.passwords.old && userData.value.passwords.new) {\n    await apiFetch(\"/user/update/password\", {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: {\n        oldPassword: userData.value.passwords.old,\n        newPassword: userData.value.passwords.new\n      },\n      credentials: \"include\",\n      ignoreResponseError: true,\n      async onResponse({ response }) {\n        const resCode: string = response._data.resCode.toString();\n\n        switch (resCode) {\n          case \"11010\":\n            alertsStore.addAlert({type: \"error\", title: \"Změna hesla\", message: \"Staré heslo nebylo zadáno.\"});\n            break;\n          case \"11020\":\n            alertsStore.addAlert({type: \"error\", title: \"Změna hesla\", message: \"Nové heslo nebylo zadáno.\"});\n            break;\n          case \"11030\":\n            alertsStore.addAlert({type: \"error\", title: \"Změna hesla\", message: \"Nesprávné staré heslo.\"});\n            break;\n          case \"11040\":\n            alertsStore.addAlert({type: \"error\", title: \"Změna hesla\", message: \"Nové heslo musí mít minimálně 5 znaků.\"});\n            break;\n          case \"11051\":\n            alertsStore.addAlert({type: \"success\", title: \"Změna hesla\", message: \"Heslo bylo úspěšně změněno.\"});\n            break;\n          default:\n            alertsStore.addAlert({type: \"error\", title: \"Změna hesla\", message: \"Nastala neznámá chyba.\"});\n            break;\n        }\n      },\n      async onRequestError() {\n        alertsStore.addAlert({type: \"error\", title: \"Změna hesla\", message: \"Nastala neznámá chyba.\"});\n      }\n    });\n  }\n\n  submitLoading.value = false;\n};\n</script>\n\n<template>\n  <NuxtLayout name=\"panel\">\n    <template #header>\n      <Navbar :links=\"[\n        { name: 'Nastavení', path: '/panel/settings' },\n        { name: 'Zabezpečení', path: '/panel/settings/security' },\n      ]\" />\n    </template>\n\n    <template #content>\n      <div id=\"settings\">\n        <Navigation class=\"navigation\" title=\"Nastavení\" :active-link-id=\"1\" :links=\"[\n          { name: 'Profil', path: '/panel/settings' },\n          { name: 'Zabezpečení', path: '/panel/settings/security' },\n          { name: 'Přizpůsobení', path: '/panel/settings/customization' },\n        ]\" />\n\n        <div class=\"content\">\n          <EditPassword class=\"page-section\" @update=\"onPasswordsUpdate\" :reset=\"triggerReset\">\n            <div class=\"section-head\">\n              <h3>Resetování hesla <span class=\"update\" v-if=\"userData.passwords.new !== userData.passwords.old && passwordRulesCheck[0] && userData.passwords.old !== ''\">(aktualizováno)</span></h3>\n              <p>Zadejte nové heslo podle doporučených pravidel níže.</p>\n\n              <div class=\"password-rules\">\n                <h4>Doporučená pravidla hesla</h4>\n                <ul>\n                  <li><Icon class=\"icon\" size=\"16px\" name=\"material-symbols:play-arrow-rounded\"></Icon> <p>Obsahuje minimálně 5 znaků <Icon size=\"16px\" name=\"material-symbols:check-rounded\" class=\"icon\" v-if=\"passwordRulesCheck[0]\"></Icon></p></li>\n                  <li><Icon class=\"icon\" size=\"16px\" name=\"material-symbols:play-arrow-rounded\"></Icon> <p>Obsahuje 2 až 3 znaky: velké, malé, čísla <Icon size=\"16px\" name=\"material-symbols:check-rounded\" class=\"icon\" v-if=\"passwordRulesCheck[1]\"></Icon></p></li>\n                  <li><Icon class=\"icon\" size=\"16px\" name=\"material-symbols:play-arrow-rounded\"></Icon> <p>Obsahuje aspoň 1 speciální znak: @, #, $, %, &, *, +, = <Icon size=\"16px\" name=\"material-symbols:check-rounded\" class=\"icon\" v-if=\"passwordRulesCheck[2]\"></Icon></p></li>\n                  <li><Icon class=\"icon\" size=\"16px\" name=\"material-symbols:play-arrow-rounded\"></Icon> <p>Neobsahuje žádné mezery <Icon size=\"16px\" name=\"material-symbols:check-rounded\" class=\"icon\" v-if=\"passwordRulesCheck[3]\"></Icon></p></li>\n                  <li><Icon class=\"icon\" size=\"16px\" name=\"material-symbols:play-arrow-rounded\"></Icon> <p>Neobsahuje žádné osobní informace</p></li>\n                </ul>\n              </div>\n            </div>\n          </EditPassword>\n\n          <EditFormFooter :submit-function=\"updateUserData\" :reset-function=\"resetUserData\" :is-loading=\"submitLoading\" />\n        </div>\n\n        <Alerts/>\n      </div>\n    </template>\n  </NuxtLayout>\n</template>\n\n<style scoped lang=\"scss\">\n#settings {\n  display: flex;\n  flex-direction: row;\n  gap: 30px;\n  position: relative;\n\n  .navigation {\n    height: fit-content;\n    position: sticky;\n    top: 110px;\n    min-width: 300px;\n  }\n\n  .content {\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 35px;\n    position: relative;\n\n    .page-section {\n      border-bottom: 1px solid rgba(var(--border-color), 0.5);\n      padding-bottom: 35px;\n    }\n\n    .section-head {\n      display: flex;\n      flex-direction: column;\n      gap: 10px;\n\n      h3 {\n        font-weight: 600;\n        font-size: 20px;\n        color: var(--title-color);\n      }\n\n      p {\n        color: rgba(var(--description-color), 1);\n        font-size: 16px;\n      }\n\n      .update {\n        color: rgba(var(--error-color), 1);\n      }\n    }\n\n    .password-rules {\n      display: flex;\n      flex-direction: column;\n      gap: 10px;\n\n      h4 {\n        font-weight: 600;\n        font-size: 16px;\n        color: var(--title-color);\n        margin-top: 10px;\n      }\n\n      ul {\n        list-style: none;\n\n        li {\n          display: flex;\n          align-items: center;\n          gap: 10px;\n          font-size: 16px;\n          color: rgba(var(--description-color), 1);\n          margin-bottom: 10px;\n\n          .icon {\n            color: rgba(var(--main-color), 1);\n            line-height: 0;\n          }\n        }\n\n        p {\n          display: flex;\n          align-items: center;\n          gap: 5px;\n\n          .icon {\n            padding-left: 5px;\n            color: rgba(var(--success-color), 1);\n          }\n        }\n      }\n    }\n\n    ::v-deep(.reset-password) {\n      flex-direction: column;\n    }\n\n    ::v-deep(.section) {\n      width: 100%;\n    }\n  }\n}\n\n@media (max-width: 1055px) {\n  #settings {\n    flex-direction: column;\n    gap: 30px;\n\n    .navigation {\n      width: 100%;\n      position: relative;\n      top: 0;\n      min-width: 200px;\n    }\n  }\n}\n</style>\n"],"names":["useHead","alertsStore","useAlertsStore","submitLoading","ref","triggerReset","passwordRulesCheck","userData","checkPasswordRules","onPasswordsUpdate","passwordsInputs","resetUserData","updateUserData","apiFetch","response"],"mappings":"8nBAUQA,EAAA,CACN,MAAO,kCACP,KAAM,CACJ,CAAE,KAAM,cAAe,QAAS,iCAAkC,CAAA,CACpE,CACD,EAED,MAAMC,EAAcC,EAAe,EAE7BC,EAAgBC,EAAa,EAAK,EAClCC,EAAeD,EAAa,EAAK,EAEjCE,EAAqBF,EAAe,CAAC,GAAO,GAAO,GAAO,EAAK,CAAC,EAChEG,EAAWH,EAAiD,CAChE,UAAW,CACT,IAAK,GACL,IAAK,EAAA,CACP,CACD,EAEKI,EAAqB,IAAY,CAIrC,GAHAF,EAAmB,MAAM,CAAC,EAAIC,EAAS,MAAM,UAAU,IAAI,QAAU,EAGjE,CAACD,EAAmB,MAAM,CAAC,EAAG,CAChCA,EAAmB,MAAQ,CAAC,GAAO,GAAO,GAAO,EAAK,EACtD,MAAA,CAGiBA,EAAA,MAAM,CAAC,EAAI,CAAC,EAAEC,EAAS,MAAM,UAAU,IAAI,MAAM,QAAQ,GAAKA,EAAS,MAAM,UAAU,IAAI,MAAM,QAAQ,GAAKA,EAAS,MAAM,UAAU,IAAI,MAAM,QAAQ,GACzJD,EAAA,MAAM,CAAC,EAAI,CAAC,CAACC,EAAS,MAAM,UAAU,IAAI,MAAM,aAAa,EAC7DD,EAAA,MAAM,CAAC,EAAI,CAACC,EAAS,MAAM,UAAU,IAAI,MAAM,KAAK,CACzE,EAEME,EAAqBC,GAAgF,CACzG,GAAI,CAACA,EAAgB,KAAO,CAACA,EAAgB,IAAK,CACvCH,EAAA,MAAM,UAAU,IAAM,GACtBA,EAAA,MAAM,UAAU,IAAM,GAC/B,MAAA,CAGFA,EAAS,MAAM,UAAY,CACzB,IAAKG,EAAgB,IACrB,IAAKA,EAAgB,GACvB,EAEmBF,EAAA,CACrB,EAEMG,EAAgB,IAAY,CAChCJ,EAAS,MAAQ,CACf,UAAW,CACT,IAAK,GACL,IAAK,EAAA,CAET,EAEAD,EAAmB,MAAQ,CAAC,GAAO,GAAO,GAAO,EAAK,EACtDD,EAAa,MAAQ,GAErB,WAAW,IAAY,CACrBA,EAAa,MAAQ,IACpB,GAAG,CACR,EAEMO,EAAiB,SAA2B,CAChDT,EAAc,MAAQ,GAElBI,EAAS,MAAM,UAAU,KAAOA,EAAS,MAAM,UAAU,KAC3D,MAAMM,EAAS,wBAAyB,CACtC,OAAQ,MACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,CACJ,YAAaN,EAAS,MAAM,UAAU,IACtC,YAAaA,EAAS,MAAM,UAAU,GACxC,EACA,YAAa,UACb,oBAAqB,GACrB,MAAM,WAAW,CAAE,SAAAO,GAAY,CAG7B,OAFwBA,EAAS,MAAM,QAAQ,SAAS,EAEvC,CACf,IAAK,QACSb,EAAA,SAAS,CAAC,KAAM,QAAS,MAAO,cAAe,QAAS,6BAA6B,EACjG,MACF,IAAK,QACSA,EAAA,SAAS,CAAC,KAAM,QAAS,MAAO,cAAe,QAAS,4BAA4B,EAChG,MACF,IAAK,QACSA,EAAA,SAAS,CAAC,KAAM,QAAS,MAAO,cAAe,QAAS,yBAAyB,EAC7F,MACF,IAAK,QACSA,EAAA,SAAS,CAAC,KAAM,QAAS,MAAO,cAAe,QAAS,yCAAyC,EAC7G,MACF,IAAK,QACSA,EAAA,SAAS,CAAC,KAAM,UAAW,MAAO,cAAe,QAAS,8BAA8B,EACpG,MACF,QACcA,EAAA,SAAS,CAAC,KAAM,QAAS,MAAO,cAAe,QAAS,yBAAyB,EAC7F,KAAA,CAEN,EACA,MAAM,gBAAiB,CACTA,EAAA,SAAS,CAAC,KAAM,QAAS,MAAO,cAAe,QAAS,yBAAyB,CAAA,CAC/F,CACD,EAGHE,EAAc,MAAQ,EACxB"}