{"version":3,"file":"BgJ95DCd.js","sources":["../../../../pages/panel/tasks/admin/add.vue"],"sourcesContent":["<script lang=\"ts\" setup>\r\nimport EditFormFooter from \"~/components/manage/Footer.vue\";\r\nimport EditName from \"~/components/manage/Name.vue\";\r\nimport EditNeedApprove from \"~/components/manage/NeedApprove.vue\";\r\nimport EditTaskFile from \"~/components/manage/TaskFile.vue\";\r\nimport EditDateTime from \"~/components/manage/DateTime.vue\";\r\nimport Alerts from \"~/components/Alerts.vue\";\r\nimport Navbar from \"~/components/Navbar.vue\";\r\nimport { ref, computed } from \"vue\";\r\nimport {useRoute} from \"#vue-router\";\r\nimport ActionBar from \"~/components/basics/ActionBar.vue\";\r\nimport apiFetch from \"~/componsables/apiFetch\";\r\nimport { useAlertsStore } from \"~/stores/alerts\";\r\nimport {useAccountStore} from \"~/stores/account\";\r\n\r\ndefinePageMeta({\r\n});\r\n\r\nuseHead({\r\n  title: \"Panel | Úkol - Přidání\",\r\n  meta: [\r\n    { name: \"description\", content: \"Panel Settings User Information\" }\r\n  ],\r\n});\r\n\r\ndefinePageMeta({\r\n  roles: [\"admin\"],\r\n});\r\n\r\nconst alertsStore = useAlertsStore();\r\nconst triggerReset = ref<boolean>(false);\r\nconst loading = ref<boolean>(false);\r\nconst oldData = computed<{ name: string, needApprove: boolean | null, taskFile: string, startDate: Date | null, endDate: Date | null }>(() => ({\r\n  name: \"\",\r\n  needApprove: null,\r\n  taskFile: \"\",\r\n  startDate: null,\r\n  endDate: null\r\n}));\r\nconst newData = ref<{ name: string | undefined, needApprove: boolean | undefined, taskFile: File | undefined, startDate: Date | undefined, endDate: Date | undefined }>({\r\n  name: undefined,\r\n  needApprove: undefined,\r\n  taskFile: undefined,\r\n  startDate: undefined,\r\n  endDate: undefined,\r\n});\r\n\r\nconst onNameUpdate = (name: string): void => {\r\n  newData.value.name = name;\r\n};\r\n\r\nconst onNeedApproveUpdate = (needApprove: boolean): void => {\r\n  newData.value.needApprove = needApprove;\r\n};\r\n\r\nconst onTaskFileUpdate = (taskFile: File | undefined): void => {\r\n  newData.value.taskFile = taskFile;\r\n};\r\n\r\nconst onStartDateUpdate = (startDate: Date | undefined): void => {\r\n  newData.value.startDate = startDate;\r\n};\r\n\r\nconst onEndDateUpdate = (endDate: Date | undefined): void => {\r\n  newData.value.endDate = endDate;\r\n};\r\n\r\nconst resetUserData = (): void => {\r\n  newData.value = {\r\n    name: undefined,\r\n    needApprove: undefined,\r\n    taskFile: undefined,\r\n    startDate: undefined,\r\n    endDate: undefined,\r\n  };\r\n\r\n  triggerReset.value = true;\r\n\r\n  setTimeout((): void => {\r\n    triggerReset.value = false;\r\n  }, 100);\r\n};\r\n\r\nconst addTask = async (): Promise<void> => {\r\n  if (!newData.value.name || !newData.value.startDate || !newData.value.endDate || !newData.value.taskFile || newData.value.needApprove === undefined) {\r\n    alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Vyplňte všechna povinná pole.\" });\r\n    return;\r\n  }\r\n\r\n  loading.value = true;\r\n\r\n  const formData = new FormData();\r\n  formData.append(\"name\", newData.value.name || \"\");\r\n  formData.append(\"startDate\", newData.value.startDate?.getTime().toString() || \"\");\r\n  formData.append(\"endDate\", newData.value.endDate?.getTime().toString() || \"\");\r\n  formData.append(\"task\", newData.value.taskFile || \"\");\r\n  formData.append(\"guarantor\", useAccountStore().getId || \"\");\r\n  formData.append(\"approve\", newData.value.needApprove ? \"true\" : \"false\");\r\n\r\n  await apiFetch(\"/task/add\", {\r\n    method: \"post\",\r\n    headers: {\r\n      \"Accept\": \"application/json\",\r\n    },\r\n    body: formData,\r\n    credentials: \"include\",\r\n    ignoreResponseError: true,\r\n    onResponse({ response }: any) {\r\n      const resCode: string = response._data.resCode.toString();\r\n\r\n      switch (resCode) {\r\n        case \"26091\":\r\n          alertsStore.addAlert({ type: \"success\", title: \"Přidání úkolu\", message: \"Úkol byl úspěšně vytvořen.\" });\r\n\r\n          resetUserData();\r\n\r\n          break;\r\n        case \"26010\":\r\n          alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Studenti nemohou vytvářet úkoly.\" });\r\n          break;\r\n        case \"26020\":\r\n          alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Název úkolu nebyl zadán.\" });\r\n          break;\r\n        case \"26030\":\r\n          alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Datum ukončení nebylo zadáno.\" });\r\n          break;\r\n        case \"26040\":\r\n          alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Datum ukončení je neplatné.\" });\r\n          break;\r\n        case \"26050\":\r\n          alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Datum ukončení je před datem začátku.\" });\r\n          break;\r\n        case \"26060\":\r\n          alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Soubor úkolu nebyl zadán.\" });\r\n          break;\r\n        case \"26070\":\r\n          alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Neplatný formát souboru.\" });\r\n          break;\r\n        case \"26080\":\r\n          alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Nebyla zadána hodnota schválení.\" });\r\n          break;\r\n        default:\r\n          alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Nastala neznámá chyba.\" });\r\n          break;\r\n      }\r\n    },\r\n    onRequestError() {\r\n      alertsStore.addAlert({ type: \"error\", title: \"Přidání úkolu\", message: \"Nastala neznámá chyba při odesílání požadavku.\" });\r\n    },\r\n  }).finally((): void => {\r\n    loading.value = false;\r\n  });\r\n};\r\n</script>\r\n\r\n<template>\r\n  <NuxtLayout name=\"panel\">\r\n    <template #header>\r\n      <Navbar :links=\"[\r\n        { name: 'Úkoly', path: `/panel/tasks/admin` },\r\n        { name: 'Přidání', path: `/panel/tasks/admin/add` },\r\n      ]\" />\r\n    </template>\r\n\r\n    <template #content>\r\n      <div id=\"tasks\">\r\n        <div class=\"content\">\r\n          <ActionBar\r\n            class=\"action-bar\"\r\n            description=\"Správa úkolů\"\r\n            :texts=\"['Přidat', 'Odebrat']\"\r\n            :actions=\"['add', 'remove']\"\r\n            :icons=\"[\r\n              'material-symbols:add-rounded',\r\n              'material-symbols:delete-rounded',\r\n            ]\"\r\n            :active=\"0\"\r\n            :navigate-to=\"[\r\n              `/panel/tasks/admin/add`,\r\n              `/panel/tasks/admin/remove`,\r\n            ]\"\r\n          />\r\n\r\n          <div class=\"line page-section\">\r\n            <EditName :old-name=\"oldData.name\" :reset=\"triggerReset\" @update=\"onNameUpdate\">\r\n              <div class=\"section-head\">\r\n                <h3>Název * <span class=\"update\" v-show=\"newData.name\">(aktualizováno)</span></h3>\r\n                <p>Zadejte název úkolu, který bude jasně vystihovat jeho obsah a účel.</p>\r\n              </div>\r\n            </EditName>\r\n          </div>\r\n\r\n          <div class=\"line page-section\">\r\n            <EditTaskFile @update=\"onTaskFileUpdate\" :reset=\"triggerReset\" :old-check=\"oldData.taskFile\">\r\n              <div class=\"section-head\">\r\n                <h3>Zadání * <span class=\"update\" v-show=\"newData.taskFile\">(aktualizováno)</span></h3>\r\n                <p>Vyberte soubor se zadáním úkolu, který budou studenti stahovat a podle něj úkol plnit. Povolené formáty: PDF, DOCX, ODT, HTML nebo ZIP.</p>\r\n              </div>\r\n            </EditTaskFile>\r\n          </div>\r\n\r\n          <div class=\"line page-section\">\r\n            <div class=\"section-head\">\r\n              <h3>Časové rozmezí úkolu *</h3>\r\n              <p>Zadejte časové rozmezí, ve kterém bude úkol aktivní. Studenti budou moci úkol odevzdávat pouze v tomto období.</p>\r\n            </div>\r\n\r\n            <div class=\"line\">\r\n              <EditDateTime @update=\"onStartDateUpdate\" :reset=\"triggerReset\" :old-date=\"oldData.startDate\" label=\"Začátek úkolu\" />\r\n              <EditDateTime @update=\"onEndDateUpdate\" :reset=\"triggerReset\" :old-date=\"oldData.endDate\" label=\"Konec úkolu\" />\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"line page-section\">\r\n            <EditNeedApprove @update=\"onNeedApproveUpdate\" :reset=\"triggerReset\" :old-check=\"oldData.needApprove\">\r\n              <div class=\"section-head\">\r\n                <h3>Nutné schválení * <span class=\"update\" v-show=\"newData.needApprove !== undefined\">(aktualizováno)</span></h3>\r\n                <p>Pokud je tato možnost aktivní, bude přijetí úkolu nejprve muset projít schválením garantem před jeho přidělením.</p>\r\n              </div>\r\n            </EditNeedApprove>\r\n          </div>\r\n\r\n          <EditFormFooter :is-loading=\"loading\" :reset-function=\"resetUserData\" :submit-function=\"addTask\">\r\n            Pole označená * jsou povinná\r\n          </EditFormFooter>\r\n        </div>\r\n\r\n        <Alerts/>\r\n      </div>\r\n    </template>\r\n  </NuxtLayout>\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n#tasks {\r\n  display: flex;\r\n  flex-direction: row;\r\n  gap: 30px;\r\n  position: relative;\r\n\r\n  .content {\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    gap: 35px;\r\n    position: relative;\r\n\r\n    .error {\r\n      color: rgba(var(--error-color), 1);\r\n      font-size: 16px;\r\n    }\r\n\r\n    .page-section {\r\n      border-bottom: 1px solid rgba(var(--border-color), 0.5);\r\n      padding-bottom: 35px;\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 30px;\r\n\r\n      .line {\r\n        width: 100%;\r\n        display: flex;\r\n        flex-direction: row;\r\n        gap: 35px;\r\n        flex-wrap: wrap;\r\n\r\n        ::v-deep(.section) {\r\n          flex: 1;\r\n        }\r\n      }\r\n    }\r\n\r\n    .section-head {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 10px;\r\n\r\n      h3 {\r\n        font-weight: 600;\r\n        font-size: 20px;\r\n        color: var(--title-color);\r\n      }\r\n\r\n      p {\r\n        color: rgba(var(--description-color), 1);\r\n        font-size: 16px;\r\n      }\r\n\r\n      .update {\r\n        color: rgba(var(--error-color), 1);\r\n      }\r\n    }\r\n\r\n    .password-rules {\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 10px;\r\n\r\n      h4 {\r\n        font-weight: 600;\r\n        font-size: 16px;\r\n        color: var(--title-color);\r\n        margin-top: 10px;\r\n      }\r\n\r\n      ul {\r\n        list-style: none;\r\n\r\n        li {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 10px;\r\n          font-size: 16px;\r\n          color: rgba(var(--description-color), 1);\r\n          margin-bottom: 10px;\r\n\r\n          .icon {\r\n            color: rgba(var(--main-color), 1);\r\n            line-height: 0;\r\n          }\r\n        }\r\n\r\n        p {\r\n          display: flex;\r\n          align-items: center;\r\n          gap: 5px;\r\n\r\n          .icon {\r\n            padding-left: 5px;\r\n            color: rgba(var(--success-color), 1);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n@media (max-width: 1055px) {\r\n  #tasks {\r\n    flex-direction: column;\r\n    gap: 30px;\r\n  }\r\n}\r\n</style>\r\n"],"names":["useHead","alertsStore","useAlertsStore","triggerReset","ref","loading","oldData","computed","newData","onNameUpdate","name","onNeedApproveUpdate","needApprove","onTaskFileUpdate","taskFile","onStartDateUpdate","startDate","onEndDateUpdate","endDate","resetUserData","addTask","formData","_a","_b","useAccountStore","apiFetch","response"],"mappings":"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"}