{"version":3,"file":"BvfYQ-3p.js","sources":["../../../../pages/password/forget/reset.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport Loading from \"~/components/basics/Loading.vue\";\nimport { ref, onMounted } from \"vue\";\nimport { useRoute } from \"#imports\";\nimport type { LocationQueryValue } from \"vue-router\";\nimport apiFetch from \"../../../componsables/apiFetch\";\n\nuseHead({\n  title: \"Panel | Resetování hesla\",\n  meta: [{ name: \"description\", content: \"Resetování hesla\" }],\n});\n\nconst messages = ref<{\n  password: string | null;\n  passwordAgain: string | null;\n  form: { message: string | null; type: \"error\" | \"success\" | null };\n}>({\n  password: null,\n  passwordAgain: null,\n  form: { message: null, type: null },\n});\nconst loading = ref<boolean>(true);\nconst tokenEmail = ref<string | null>(null);\nconst formData = ref<{ password: string; passwordAgain: string }>({\n  password: \"\",\n  passwordAgain: \"\",\n});\n\nconst validateForm = () => {\n  if (formData.value.password.length < 5)\n    messages.value.password = \"Nové heslo musí mít nejméně 5 znaků\";\n  if (!formData.value.password) messages.value.password = \"Zadejte nové heslo\";\n  if (!formData.value.passwordAgain)\n    messages.value.passwordAgain = \"Zadejte heslo znovu\";\n  else if (formData.value.passwordAgain !== formData.value.password)\n    messages.value.passwordAgain = \"Hesla se neshodují\";\n};\n\nconst resetMessages = (): void => {\n  messages.value = {\n    password: null,\n    passwordAgain: null,\n    form: { message: null, type: null },\n  };\n};\n\nconst submitForm = async (): Promise<void> => {\n  validateForm();\n\n  if (\n    messages.value.password ||\n    messages.value.passwordAgain ||\n    messages.value.form.type === \"error\"\n  )\n    return;\n\n  loading.value = true;\n\n  await apiFetch(\"/user/password/reset\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: {\n      email: tokenEmail.value,\n      newPassword: formData.value.password,\n    },\n    credentials: \"include\",\n    ignoreResponseError: true,\n    async onResponse({ response }) {\n      const resCode: string = response._data.resCode.toString();\n\n      switch (resCode) {\n        case \"14010\":\n          messages.value.form = {\n            message: \"Špatný formát e-mailu\",\n            type: \"error\",\n          };\n          break;\n        case \"14020\":\n          messages.value.form = {\n            message: \"Účet nebyl nalezen\",\n            type: \"error\",\n          };\n          break;\n        case \"14030\":\n          messages.value.form = {\n            message: \"Chybí nové heslo\",\n            type: \"error\",\n          };\n          break;\n        case \"14040\":\n          messages.value.form = {\n            message: \"Nové heslo musí mít nejméně 5 znaků\",\n            type: \"error\",\n          };\n          break;\n        case \"14051\":\n          messages.value.form = {\n            message: \"Heslo bylo úspěšně změněno\",\n            type: \"success\",\n          };\n          formData.value.password = \"\";\n          formData.value.passwordAgain = \"\";\n          break;\n        default:\n          messages.value.form = {\n            message: \"Nastala neznámá chyba\",\n            type: \"error\",\n          };\n          break;\n      }\n    },\n    async onRequestError() {\n      messages.value.form = {\n        message: \"Nastala neznámá chyba\",\n        type: \"error\",\n      };\n    },\n  });\n\n  loading.value = false;\n};\n\nonMounted(async (): Promise<void> => {\n  const token: LocationQueryValue | LocationQueryValue[] = useRoute().query.token;\n\n  if (!token) tokenEmail.value = null;\n\n  await apiFetch(\"/user/password/verify\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: {\n      token: token,\n    },\n    credentials: \"include\",\n    ignoreResponseError: true,\n    async onResponse({ response }) {\n      const resCode: string = response._data.resCode.toString();\n\n      switch (resCode) {\n        case \"13021\":\n          tokenEmail.value = response._data.data.email;\n          break;\n        default:\n          tokenEmail.value = null;\n          break;\n      }\n    },\n    async onResponseError() {\n      tokenEmail.value = null;\n    },\n  });\n\n  loading.value = false;\n});\n</script>\n\n<template>\n  <div id=\"forgetPassword-reset-error\" v-if=\"!tokenEmail\">\n    <div v-if=\"loading\" class=\"loading-big\">\n      <Loading color=\"rgba(var(--description-color), 1)\" size=\"24px\" />\n    </div>\n\n    <div class=\"container card\" v-if=\"!loading\">\n      <div class=\"head\">\n        <h2>Token je neplatný</h2>\n        <p>\n          Token pro resetování hesla je neplatný nebo vypršel, je potřeba\n          vytvořit nový token a zkusit to znovu\n        </p>\n      </div>\n\n      <div class=\"footer\">\n        <a href=\"/password/forget/new\"\n          ><button type=\"submit\">Zkusit znovu</button></a\n        >\n      </div>\n    </div>\n  </div>\n\n  <div id=\"forgetPassword-reset\" v-if=\"tokenEmail\">\n    <div class=\"container\">\n      <div class=\"head\">\n        <h2>Změna hesla</h2>\n        <p>Resetujte si heslo k vašemu účtu zadáním nového hesla</p>\n      </div>\n\n      <form @submit.prevent=\"submitForm\" @input=\"resetMessages\">\n        <div class=\"section\">\n          <label for=\"password\">Nové heslo</label>\n          <input\n            type=\"password\"\n            id=\"password\"\n            name=\"password\"\n            placeholder=\"*****\"\n            v-model=\"formData.password\"\n          />\n          <p v-if=\"messages.password\" class=\"error\">{{ messages.password }}</p>\n        </div>\n\n        <div class=\"section\">\n          <label for=\"passwordAgain\">Heslo znovu</label>\n          <input\n            type=\"password\"\n            id=\"passwordAgain\"\n            name=\"passwordAgain\"\n            placeholder=\"*****\"\n            v-model=\"formData.passwordAgain\"\n          />\n          <p v-if=\"messages.passwordAgain\" class=\"error\">\n            {{ messages.passwordAgain }}\n          </p>\n        </div>\n\n        <div class=\"footer\">\n          <button type=\"submit\">Změnit heslo</button>\n          <p\n            v-if=\"messages.form.message\"\n            :class=\"{\n              error: messages.form.type === 'error',\n              success: messages.form.type === 'success',\n            }\"\n          >\n            {{ messages.form.message }}\n          </p>\n        </div>\n\n        <div v-if=\"loading\" class=\"loading\">\n          <Loading color=\"rgba(var(--description-color), 1)\" size=\"6px\" />\n        </div>\n\n        <a href=\"/\">Máte změněno?</a>\n      </form>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n#forgetPassword-reset,\n#forgetPassword-reset-error {\n  width: 100%;\n  min-height: 400px;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n\n  .loading-big span span {\n    width: 50px;\n  }\n\n  .card {\n    display: flex;\n    flex-direction: column;\n    gap: 20px;\n    border-radius: var(--medium-border-radius);\n    border: var(--border-width) solid rgba(var(--border-color), 0.5);\n    padding: 30px;\n\n    .head h2 {\n      color: rgba(var(--error-color), 1);\n      font-weight: 700;\n      font-size: 28px;\n    }\n\n    .footer button {\n      padding: 15px;\n      border-radius: var(--normal-border-radius);\n      background: rgba(var(--error-color), 1);\n      color: var(--btn-1-color);\n      transition: 0.2s;\n      font-weight: var(--btn-1-font-weight);\n      font-size: 16px;\n      width: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: 15px;\n\n      &:hover {\n        filter: brightness(1.2);\n      }\n    }\n  }\n}\n\n.container {\n  max-width: 500px;\n  padding: 1.1rem;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  gap: 30px;\n\n  .head {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    justify-content: center;\n    align-items: center;\n    text-align: center;\n\n    h2 {\n      font-weight: 900;\n      font-size: 32px;\n      color: var(--title-color);\n    }\n\n    p {\n      color: rgba(var(--description-color), 1);\n      font-size: 16px;\n    }\n  }\n\n  .footer {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n\n    button {\n      padding: 15px;\n      border-radius: var(--normal-border-radius);\n      background: var(--btn-1-background);\n      color: var(--btn-1-color);\n      transition: 0.2s;\n      font-weight: var(--btn-1-font-weight);\n      font-size: 16px;\n      width: 100%;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      gap: 15px;\n\n      &:hover {\n        background: var(--btn-1-hover-background);\n      }\n    }\n  }\n}\n\n#forgetPassword-reset {\n  .container {\n    form {\n      display: flex;\n      flex-direction: column;\n      gap: 30px;\n      border: var(--border-width) solid rgba(var(--border-color), 0.5);\n      border-radius: var(--medium-border-radius);\n      padding: 30px;\n\n      label {\n        color: var(--mini-title-color);\n        font-size: 16px;\n        font-weight: 500;\n        cursor: pointer;\n      }\n\n      .loading {\n        display: flex;\n        justify-content: center;\n      }\n\n      .error {\n        font-size: 16px;\n        color: rgba(var(--error-color), 1);\n      }\n\n      .success {\n        font-size: 16px;\n        color: rgba(var(--success-color), 1);\n      }\n\n      .section {\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n\n        input {\n          border-radius: var(--normal-border-radius);\n          border: var(--border-width) solid rgba(var(--border-color), 0.5);\n          padding: 15px;\n          font-size: 16px;\n          outline: none;\n          background: var(--input-background);\n          color: var(--input-color);\n\n          &::placeholder {\n            color: var(--input-placeholder-color);\n          }\n\n          &:focus {\n            border-color: rgba(var(--main-color), 1);\n          }\n        }\n      }\n\n      .custom-item {\n        display: flex;\n        flex-direction: row;\n        gap: 10px;\n        align-items: center;\n\n        input[type=\"checkbox\"] {\n          accent-color: rgba(var(--main-color), 1);\n          height: 15px;\n          width: 15px;\n          border-radius: var(--mini-border-radius);\n          cursor: pointer;\n        }\n      }\n\n      .footer {\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n\n        button {\n          padding: 15px;\n          border-radius: var(--normal-border-radius);\n          background: var(--btn-1-background);\n          color: var(--btn-1-color);\n          transition: 0.2s;\n          font-weight: var(--btn-1-font-weight);\n          font-size: 16px;\n          width: 100%;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          gap: 15px;\n\n          &:hover {\n            background: var(--btn-1-hover-background);\n          }\n        }\n      }\n\n      a {\n        color: rgba(var(--description-color), 1);\n        font-size: 16px;\n        transition: 0.2s;\n        width: fit-content;\n\n        &:hover {\n          color: var(--mini-title-color);\n        }\n      }\n    }\n  }\n}\n</style>\n"],"names":["useHead","messages","ref","loading","tokenEmail","formData","validateForm","resetMessages","submitForm","apiFetch","response","onMounted","token","useRoute"],"mappings":"ujBAOQA,EAAA,CACN,MAAO,2BACP,KAAM,CAAC,CAAE,KAAM,cAAe,QAAS,kBAAoB,CAAA,CAAA,CAC5D,EAED,MAAMC,EAAWC,EAId,CACD,SAAU,KACV,cAAe,KACf,KAAM,CAAE,QAAS,KAAM,KAAM,IAAK,CAAA,CACnC,EACKC,EAAUD,EAAa,EAAI,EAC3BE,EAAaF,EAAmB,IAAI,EACpCG,EAAWH,EAAiD,CAChE,SAAU,GACV,cAAe,EAAA,CAChB,EAEKI,EAAe,IAAM,CACrBD,EAAS,MAAM,SAAS,OAAS,IACnCJ,EAAS,MAAM,SAAW,uCACvBI,EAAS,MAAM,WAAUJ,EAAS,MAAM,SAAW,sBACnDI,EAAS,MAAM,cAEXA,EAAS,MAAM,gBAAkBA,EAAS,MAAM,WACvDJ,EAAS,MAAM,cAAgB,sBAF/BA,EAAS,MAAM,cAAgB,qBAGnC,EAEMM,EAAgB,IAAY,CAChCN,EAAS,MAAQ,CACf,SAAU,KACV,cAAe,KACf,KAAM,CAAE,QAAS,KAAM,KAAM,IAAK,CACpC,CACF,EAEMO,EAAa,SAA2B,CAC/BF,EAAA,EAGX,EAAAL,EAAS,MAAM,UACfA,EAAS,MAAM,eACfA,EAAS,MAAM,KAAK,OAAS,WAI/BE,EAAQ,MAAQ,GAEhB,MAAMM,EAAS,uBAAwB,CACrC,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,CACJ,MAAOL,EAAW,MAClB,YAAaC,EAAS,MAAM,QAC9B,EACA,YAAa,UACb,oBAAqB,GACrB,MAAM,WAAW,CAAE,SAAAK,GAAY,CAG7B,OAFwBA,EAAS,MAAM,QAAQ,SAAS,EAEvC,CACf,IAAK,QACHT,EAAS,MAAM,KAAO,CACpB,QAAS,wBACT,KAAM,OACR,EACA,MACF,IAAK,QACHA,EAAS,MAAM,KAAO,CACpB,QAAS,qBACT,KAAM,OACR,EACA,MACF,IAAK,QACHA,EAAS,MAAM,KAAO,CACpB,QAAS,mBACT,KAAM,OACR,EACA,MACF,IAAK,QACHA,EAAS,MAAM,KAAO,CACpB,QAAS,sCACT,KAAM,OACR,EACA,MACF,IAAK,QACHA,EAAS,MAAM,KAAO,CACpB,QAAS,6BACT,KAAM,SACR,EACAI,EAAS,MAAM,SAAW,GAC1BA,EAAS,MAAM,cAAgB,GAC/B,MACF,QACEJ,EAAS,MAAM,KAAO,CACpB,QAAS,wBACT,KAAM,OACR,EACA,KAAA,CAEN,EACA,MAAM,gBAAiB,CACrBA,EAAS,MAAM,KAAO,CACpB,QAAS,wBACT,KAAM,OACR,CAAA,CACF,CACD,EAEDE,EAAQ,MAAQ,GAClB,EAEA,OAAAQ,EAAU,SAA2B,CAC7B,MAAAC,EAAmDC,IAAW,MAAM,MAErED,IAAOR,EAAW,MAAQ,MAE/B,MAAMK,EAAS,wBAAyB,CACtC,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,CACJ,MAAAG,CACF,EACA,YAAa,UACb,oBAAqB,GACrB,MAAM,WAAW,CAAE,SAAAF,GAAY,CAG7B,OAFwBA,EAAS,MAAM,QAAQ,SAAS,EAEvC,CACf,IAAK,QACQN,EAAA,MAAQM,EAAS,MAAM,KAAK,MACvC,MACF,QACEN,EAAW,MAAQ,KACnB,KAAA,CAEN,EACA,MAAM,iBAAkB,CACtBA,EAAW,MAAQ,IAAA,CACrB,CACD,EAEDD,EAAQ,MAAQ,EAAA,CACjB"}