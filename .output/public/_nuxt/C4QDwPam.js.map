{"version":3,"file":"C4QDwPam.js","sources":["../../../../pages/login.vue"],"sourcesContent":["<script lang=\"ts\" setup>\nimport Loading from \"~/components/basics/Loading.vue\";\nimport { ref } from \"vue\";\nimport apiFetch from \"../componsables/apiFetch\";\nimport { navigateTo, useCookie, useRuntimeConfig } from \"nuxt/app\";\nimport type { AccountData } from \"../types/account\";\nimport type { RuntimeConfig } from \"nuxt/schema\";\n\nuseHead({\n  title: \"Panel | Přihlášení\",\n  meta: [{ name: \"description\", content: \"Panel Login Page\" }],\n});\n\nconst loginData = ref<{\n  login: string | null;\n  password: string | null;\n  stayLogged: boolean;\n}>({ login: null, password: null, stayLogged: false });\nconst errors = ref<{\n  login: string | null;\n  password: string | null;\n  req: string | null;\n}>({ login: null, password: null, req: null });\nconst loading = ref<boolean>(false);\n\n// Check user inputs\nconst validateLogin = (): void => {\n  resetErrors();\n\n  if (!loginData.value.login)\n    errors.value.login = \"Zadejte váš e-mail nebo zkratku\";\n  if (!loginData.value.password) errors.value.password = \"Zadejte vaše heslo\";\n};\n\n// Check user inputs and send request to backend\nconst submitLoginForm = async (): Promise<void> => {\n  validateLogin();\n\n  if (errors.value.login || errors.value.password) return;\n\n  loading.value = true;\n\n  await apiFetch(\"/auth/login\", {\n    method: \"POST\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    body: {\n      login: loginData.value.login,\n      password: loginData.value.password,\n      stayLogged: loginData.value.stayLogged,\n    },\n    credentials: \"include\",\n    ignoreResponseError: true,\n    async onResponse({ response }) {\n      const resCode: string = response._data.resCode.toString();\n\n      switch (resCode) {\n        case \"6010\":\n          errors.value.req = \"Login nebo heslo nebylo zadáno\";\n          break;\n        case \"6020\":\n          errors.value.req = \"Špatný login nebo heslo\";\n          break;\n        case \"6031\":\n          useCookie(\"accountData\").value = JSON.stringify({\n            profilePicture: response._data.data.user.profilePicture,\n            email: response._data.data.user.email,\n            name: response._data.data.user.name,\n            surname: response._data.data.user.surname,\n            idClass: response._data.data.user.idClass,\n            abbreviation: response._data.data.user.abbreviation,\n            createdAt: response._data.data.user.createdAt,\n          } as AccountData);\n\n          navigateTo(\"/panel\");\n          break;\n        default:\n          errors.value.req = \"Nastala neznámá chyba\";\n          break;\n      }\n    },\n    async onRequestError() {\n      errors.value.req = \"Nastala neznámá chyba\";\n    },\n  }).finally((): void => {\n    loading.value = false;\n  });\n};\n\nconst resetErrors = (): void => {\n  errors.value = {\n    login: null,\n    password: null,\n    req: null,\n  };\n};\n</script>\n\n<template>\n  <div id=\"login-form\">\n    <div class=\"container\">\n      <div class=\"head\">\n        <h2>INOSU panel</h2>\n        <p>Přihlaste se do systému pomocí svého účtu</p>\n      </div>\n\n      <form @submit.prevent=\"submitLoginForm\" @input=\"resetErrors\">\n        <div class=\"section\">\n          <label for=\"login\">E-mail / Zkratka</label>\n          <input\n            id=\"login\"\n            v-model=\"loginData.login\"\n            type=\"text\"\n            name=\"login\"\n            placeholder=\"example.email@gmail.com / JANO\"\n          />\n          <p v-if=\"errors.login\" class=\"error\">{{ errors.login }}</p>\n        </div>\n\n        <div class=\"section\">\n          <label for=\"password\">Heslo</label>\n          <input\n            id=\"password\"\n            v-model=\"loginData.password\"\n            type=\"password\"\n            name=\"password\"\n            placeholder=\"*****\"\n          />\n          <p v-if=\"errors.password\" class=\"error\">{{ errors.password }}</p>\n        </div>\n\n        <div class=\"custom-item\">\n          <input\n            id=\"stayLogged\"\n            type=\"checkbox\"\n            name=\"stayLogged\"\n            @change=\"() => (loginData.stayLogged = !loginData.stayLogged)\"\n          />\n          <label for=\"stayLogged\">Zůstat přihlášen</label>\n        </div>\n\n        <div class=\"footer\">\n          <button type=\"submit\">Přihlásit se</button>\n          <p v-if=\"errors.req\" class=\"error\">{{ errors.req }}</p>\n        </div>\n\n        <div v-if=\"loading\" class=\"loading\">\n          <Loading color=\"rgba(var(--description-color), 1)\" size=\"6px\" />\n        </div>\n\n        <a href=\"/password/forget/new\">Zapomněli jste heslo?</a>\n      </form>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\" scoped>\n#login-form {\n  width: 100%;\n  min-height: 800px;\n  height: 100vh;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 20px;\n\n  .container {\n    max-width: 500px;\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    gap: 30px;\n    width: 100%;\n\n    .head {\n      display: flex;\n      flex-direction: column;\n      gap: 10px;\n      justify-content: center;\n      align-items: center;\n      text-align: center;\n\n      h2 {\n        font-weight: 900;\n        font-size: 36px;\n        color: var(--title-color);\n      }\n\n      p {\n        color: rgba(var(--description-color), 1);\n        font-size: 16px;\n      }\n    }\n\n    form {\n      display: flex;\n      flex-direction: column;\n      gap: 30px;\n      border-radius: var(--medium-border-radius);\n      border: var(--border-width) solid rgba(var(--border-color), 0.5);\n      padding: 30px;\n\n      label {\n        color: var(--mini-title-color);\n        font-size: 16px;\n        font-weight: 500;\n        cursor: pointer;\n      }\n\n      .loading {\n        display: flex;\n        justify-content: center;\n      }\n\n      .error {\n        font-size: 16px;\n        color: rgba(var(--error-color), 1);\n      }\n\n      .section {\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n\n        input {\n          border-radius: var(--normal-border-radius);\n          border: var(--border-width) solid rgba(var(--border-color), 0.5);\n          padding: 15px;\n          font-size: 16px;\n          outline: none;\n          background: var(--input-background);\n          color: var(--input-color);\n\n          &::placeholder {\n            color: var(--input-placeholder-color);\n          }\n\n          &:focus {\n            border-color: rgba(var(--main-color), 1);\n          }\n        }\n      }\n\n      .custom-item {\n        display: flex;\n        flex-direction: row;\n        gap: 10px;\n        align-items: center;\n\n        input[type=\"checkbox\"] {\n          accent-color: rgba(var(--main-color), 1);\n          height: 15px;\n          width: 15px;\n          border-radius: var(--mini-border-radius);\n          cursor: pointer;\n        }\n      }\n\n      .footer {\n        display: flex;\n        flex-direction: column;\n        gap: 10px;\n\n        button {\n          padding: 15px;\n          border-radius: var(--normal-border-radius);\n          background: var(--btn-1-background);\n          color: var(--btn-1-color);\n          transition: 0.2s;\n          font-weight: var(--btn-1-font-weight);\n          font-size: 16px;\n          width: 100%;\n\n          &:hover {\n            background: var(--btn-1-hover-background);\n          }\n        }\n      }\n\n      a {\n        color: rgba(var(--description-color), 1);\n        font-size: 16px;\n        transition: 0.2s;\n        width: fit-content;\n\n        &:hover {\n          color: var(--mini-title-color);\n        }\n      }\n    }\n  }\n}\n</style>\n"],"names":["useHead","loginData","ref","errors","loading","validateLogin","resetErrors","submitLoginForm","apiFetch","response","useCookie","navigateTo"],"mappings":"2fAQQA,EAAA,CACN,MAAO,qBACP,KAAM,CAAC,CAAE,KAAM,cAAe,QAAS,kBAAoB,CAAA,CAAA,CAC5D,EAEK,MAAAC,EAAYC,EAIf,CAAE,MAAO,KAAM,SAAU,KAAM,WAAY,GAAO,EAC/CC,EAASD,EAIZ,CAAE,MAAO,KAAM,SAAU,KAAM,IAAK,KAAM,EACvCE,EAAUF,EAAa,EAAK,EAG5BG,EAAgB,IAAY,CACpBC,EAAA,EAEPL,EAAU,MAAM,QACnBE,EAAO,MAAM,MAAQ,mCAClBF,EAAU,MAAM,WAAUE,EAAO,MAAM,SAAW,qBACzD,EAGMI,EAAkB,SAA2B,CACnCF,EAAA,EAEV,EAAAF,EAAO,MAAM,OAASA,EAAO,MAAM,YAEvCC,EAAQ,MAAQ,GAEhB,MAAMI,EAAS,cAAe,CAC5B,OAAQ,OACR,QAAS,CACP,eAAgB,kBAClB,EACA,KAAM,CACJ,MAAOP,EAAU,MAAM,MACvB,SAAUA,EAAU,MAAM,SAC1B,WAAYA,EAAU,MAAM,UAC9B,EACA,YAAa,UACb,oBAAqB,GACrB,MAAM,WAAW,CAAE,SAAAQ,GAAY,CAG7B,OAFwBA,EAAS,MAAM,QAAQ,SAAS,EAEvC,CACf,IAAK,OACHN,EAAO,MAAM,IAAM,iCACnB,MACF,IAAK,OACHA,EAAO,MAAM,IAAM,0BACnB,MACF,IAAK,OACHO,EAAU,aAAa,EAAE,MAAQ,KAAK,UAAU,CAC9C,eAAgBD,EAAS,MAAM,KAAK,KAAK,eACzC,MAAOA,EAAS,MAAM,KAAK,KAAK,MAChC,KAAMA,EAAS,MAAM,KAAK,KAAK,KAC/B,QAASA,EAAS,MAAM,KAAK,KAAK,QAClC,QAASA,EAAS,MAAM,KAAK,KAAK,QAClC,aAAcA,EAAS,MAAM,KAAK,KAAK,aACvC,UAAWA,EAAS,MAAM,KAAK,KAAK,SAAA,CACtB,EAEhBE,EAAW,QAAQ,EACnB,MACF,QACER,EAAO,MAAM,IAAM,wBACnB,KAAA,CAEN,EACA,MAAM,gBAAiB,CACrBA,EAAO,MAAM,IAAM,uBAAA,CACrB,CACD,EAAE,QAAQ,IAAY,CACrBC,EAAQ,MAAQ,EAAA,CACjB,EACH,EAEME,EAAc,IAAY,CAC9BH,EAAO,MAAQ,CACb,MAAO,KACP,SAAU,KACV,IAAK,IACP,CACF"}